# next_day
!Next Day
!Overhauled by crushboss

gs '#dynamic'
gs '#txt'
gs '#txt_2'

killvar 'play_sound'
killvar '$text'
killvar 'sex'
killvar 'sex_num'
killvar 'sex_done_today'
killvar 'sex_done_thisperson'
killvar 'today_sex_assistant'
killvar 'today_sex_curslave'
killvar 'already_sex_curslave'
killvar 'суперудар_сделан'

!Debug
!msg 'total_food_cost = <<total_food_cost>>'
!AddOn - makes more sense to reset here instead on every $newloc trigger
master_mood_rate = 0
if search['active'] = 1: gs '$expert_search'
npc = 0
city_random_event = 0
base_score += master_mood

gs '$newloc'

!Set base rules if you own a pet Fiend - crushboss
if assistant_tentacle_rule = 1 and assistant_state = 1: slave_tentacle_rule = 0
if slave_state = CONST_INT['no_exist']: slave_tentacle_rule = 0
if slave_tentacle_rule = 1 and slave_state = CONST_INT['slave_exist']: assistant_tentacle_rule = 0
if assistant_state ! 1: assistant_tentacle_rule = 0

debt_count -= 1
if debt_count < 0 and debt > 0:
	dynamic $death, 'As in any other city, in Eternal Rome it is reckless to forget to repay money you have borrowed. You died a disgraceful death at the hand of the moneylender''s henchmen...'
end

if contract['active'] = 2: contract['active'] = 0

$special_bg = ''
if wizard_mode = 0: auspex = raven_crown_on

stock_limit = RAND (3,5)
stock_sold = 0
stock_pending = 0
auction_phase = 0
haggling_stage = 0
sl_txt = 0

IF gladi_count > 0:
 gladi_count -= 1
 else
 gladi_count = 7
END

!Testing Code - every day is a Gladiatrix contest, Race contest, or auction day - crushboss
!gladi_count = 0
!ride_count = 1
!auction_count = 1
!End of Testing Code - crushboss

IF ride_count > 0:
 ride_count -= 1
 else
 ride_count = 7
 !Creating a route to the next race
 $trace[1] = 'ride_start'
 i = 1
 :loop_trace
 i += 1
 a = RAND (1,12)
 $trace[i] = $trace_type[a]
 if i < 11: jump 'loop_trace'
 $trace[12] = 'ride_finish' 
END 

IF auction_count > 0:
 auction_count -= 1
 else
 auction_count = 7
END

!Daily Expanses
if stasis_tank > 0: sparks -= 2
if iced_1_state > 0: sparks -= 1
if iced_2_state > 0: sparks -= 1
if iced_3_state > 0: sparks -= 1
if iced_4_state > 0: sparks -= 1
if iced_5_state > 0: sparks -= 1
if iced_6_state > 0: sparks -= 1

!NPC state
gs 'npc_progress'
farid_debt += farid_potential_debt 
farid_potential_debt = 0

!training contract time rise
if contract['active'] = 1: contract['time'] += 1

!reveal hidden traits
IF slave['weight_before'] ! slave["fat"]: 
 if slave["metabolism_revealed"] = 0: slave["metabolism_revealed"] = 1
END
slave['weight_before'] = slave["fat"]
!if slave["memory_revealed"] = 0: slave["memory_revealed"] = 1

!Forgotten rewards, merits, and virtue - improved - crushboss
IF slave["virtue"] > 0:
 slave_rate["mood"] -= (slave["virtue"]*2)
 if slave["moral"] < 3: slave_rate["angst"] += (slave["virtue"]*2)
 if slave["virtue"] > slave["neg_no_prise"]: slave["neg_no_prise"] = slave["virtue"]
 slave_rate["rational"] += 1
 slave["virtue"] = 0
END

!Forgotten sins - improved - crushboss
IF slave["sin"] > 0:
 if slave["sin"] > slave["fear"]: slave["fear"] -= 1
 if slave["fear"] < 0: slave["fear"] = 0
 slave_rate["fear"] -= (slave["sin"]*2)
 slave_rate["mood"] += slave["sin"]
 slave_rate["spoil"] += (slave["sin"]*2)
 if slave["pos_no_punish"] < slave["sin"] and slave["fear"] > 0: slave["pos_no_punish"] = slave["sin"]
 slave_rate["rational"] -= 1  
 slave["sin"] = 0
END

!independent slave actions
!added check for health and unconsciousness, if health is zero or it she lying unconscious, the slave will not be able to escape or attack - the_vm
slave_attack = 0
slave_escape = 0
slave_suicide = 0
IF slave["mood"] < 0 and slave['temper'] > slave['obedience']:
 n = 7 + master_cha
 if assistant_state = 1:
  n += assistant["intellect"] + assistant["moral"]
  if assistant_supervise_rule = 1: n += assistant["ego"] + assistant["gladiatrix"]
 end
 chance = RAND(1,n)
 slave_power = slave["gladiatrix"] + slave["stamina"]
 master_power = master_str + master_fighter
 IF chance = 1 and slave['stamina'] > 0 and slave_state = CONST_INT['slave_exist']:
  IF slave['angst'] > 0 and master_power < slave_power:
   slave_attack = 1
   elseif slave['brand'] ! 3 and slave['slave_collar'] = 0:
   slave_escape = 1
   elseif slave['brand'] = 3:
   slave_escape = 2
   elseif (slave['brand'] = 1 or slave['brand'] = 2) and slave['slave_collar'] = 1:
   slave_escape = 3
   elseif slave['brand'] = 4 and slave['slave_collar'] = 1:
   slave_escape = 4
  END
 END 
END

!Added an extra chance for the slave to turn on her master and attack - crushboss
IF slave['angst'] > 2 and slave['stamina'] > 3 and slave["gladiatrix"] > 3 and slave["obedience"] < 5 and slave["moral"] = 0 and slave["mood"] < 0 and master_supermacy < 2 and exam_in_progress = 0:
	slave_attack = 1
	slave_escape = 0
END

!Slave will not escape or attack with high obedience or devotion - crushboss
IF slave["obedience"] > 7 or slave["moral"] > 1 or slave["instinct"] > 3:
	slave_escape = 0
	slave_attack = 0
END

!slave cannot escape during exam in training mode
!slaves will heal from wounds in tutorial mode since there is no medical center to visit - crushboss
!slaves will recover from negative energy in tutorial mode - crushboss
IF exam_in_progress = 1:
 slave_escape = 0
 if slave_rate["wounds"] > 0: slave_rate["wounds"] += slave["stamina"] + 2
 if slave["energy"] < 0: slave["energy"] += 1
 if slave["energy"] < 0 and slave["stamina"] > 3: slave["energy"] += 1
END

a = slave['ego'] + slave['custom']
IF slave['angst'] > a:
 chance = RAND(0,10)
 if chance < slave['angst']: slave_suicide = 1
END

!Bull Ring enhancement - crushboss
if bull_ring_on = 1 and master_energy < 1: master_energy = 1

!No free time if energy is 0 or less - crushboss
if slave["energy"] <= 0: free_time = 0

!Decrease Fiend Milking count by one each day - crushboss
if spawn_milked > 0: spawn_milked -= 1

!Slave Cook rule
IF slave_cooks_rule = 1 and cooked_food <= 0 and kitchen > 0 and slave["energy"] > 0 and slave_state = CONST_INT['slave_exist']:
 slave_auto_cook = 1
 cooked_food = slave["cook"]
 slave_rate["cook"] += 1
 house_mess_rate += 5  
 slave["energy"] -= 1
END

!Slave Tentacle rule - crushboss
IF slave_tentacle_rule = 1 and pet_tentacle > 0  and slave["energy"] >= 0 and slave_state = CONST_INT['slave_exist']:
 IF tentacle_state = 1 or spawn_milked = 0:
  slave_auto_tentacle = 1
  slave["energy"] -= 1 
  slave_rate["hygiene"] += 20
  tentacle_hp += 2
  IF slave["sub_tentacles"] > tentacle_size: 
   spawn_milked = 2
   tentacle_state = 2
   tentacle_hp += 2
   spawn_semen += semen_gain[tentacle_size]
  END
 END 
END

!Slave washes master - Bath Rule - Slave
IF slave["energy"] >= 0 and slave_washes_rule = 1 and master_hygiene > 0 and bath > 0 and slave_state = CONST_INT['slave_exist']:
 slave_auto_wash = 1
 house_mess_rate += 3
 slave_rate["hygiene"] = 0
 slave["hygiene"] = 0
 slave["pos_slave_clean"] = 1
 slave_rate["arousal"] -= master_libido
 master_hygiene_rate = 0 
 master_hygiene = 0
 master_mood['pos_self_clean'] = 1
 master_mood_rate += min (slave["petting"], slave["oral"])
END

!Slave Clean rule
IF slave_cleans_rule = 1 and house_mess > 1 and slave["energy"] > 0 and slave_state = CONST_INT['slave_exist']:
 slave_auto_clean = 1
 slave_rate["service"] += 1
 house_mess_rate = 0  
 dynamic '$house_cleaning' 
 slave["energy"] -= 1
END

previous_energy = slave["energy"]

IF slave["energy"] > 0 and slave_state = CONST_INT['slave_exist']:
 free_time = slave["energy"]
END

!Slave will wash herself if the assistant doesnt wash slave and the master is clean if the bath slave rule is enabled - crushboss
IF previous_energy >= 0 and slave_state = CONST_INT['slave_exist'] and assistant_washe_slave_rule ! 1:
 IF bath > 0 and slave["hygiene"] > 0:
  IF slave_washes_rule ! 1 or master_hygiene = 0:
   slave_auto_bathing = 1
   slave_rate["mood"] += slave["hygiene"]
   slave["pos_slave_clean"] = 1
   slave_rate["hygiene"] = 0
   slave["hygiene"] = 0
  END
 END
END

IF free_time > 0 and slave_state = CONST_INT['slave_exist']:
 slave_auto_rest = 1
 slave_well_rested += free_time
 slave_rate["mood"] += free_time
END

if slave_well_rested >= slave["stamina"]: slave_rate["stamina"] += 2
if slave["energy"] >= 0 and slave_well_rested > 0: slave["pos_well_rested"] = 1
slave["energy"] += slave_well_rested
if slave["energy"] > 5: slave["energy"] = 5
slave_well_rested = 0

!Independent assistant actions

!Assistant Cooks Rule
IF assistant_cooks_rule = 1 and cooked_food <= 0 and kitchen > 0 and assistant["energy"] > 0:
 assistant_auto_cook = 1
 cooked_food = assistant["cook"]
 assistant_rate["cook"] += 1
 house_mess_rate += 5  
 assistant["energy"] -= 1
END

!Assistant Tentacle rule - crushboss
IF assistant_tentacle_rule = 1 and pet_tentacle > 0 and assistant["energy"] >= 0 and assistant_state ! 0:
 IF tentacle_state = 1 or spawn_milked = 0:
  assistant_auto_tentacle = 1
  assistant["energy"] -= 1 
  assistant_rate["hygiene"] += 20
  tentacle_hp += 2
  IF assistant["sub_tentacles"] > tentacle_size: 
   spawn_milked = 2
   tentacle_state = 2
   tentacle_hp += 2
   spawn_semen += semen_gain[tentacle_size]
  END
 END 
END

!Tentacle state - milked or needs milking - crushboss
IF pet_tentacle = 0:
 tentacle_state = 0
 else
 if spawn_milked = 0: tentacle_state = 1
 if spawn_milked > 0: tentacle_state = 2
END

!Assistant washes master - Bath Rule - Assistant
IF assistant["energy"] >= 0 and assistant_washes_rule = 1 and master_hygiene > 0 and bath > 0:
 assistant_auto_wash = 1
 house_mess_rate += 3
 assistant_rate["hygiene"] = 0
 assistant["hygiene"] = 0
 assistant_rate["arousal"] -= master_libido
 master_hygiene_rate = 0
 master_hygiene = 0
 master_mood['pos_self_clean'] = 1
 master_mood_rate += min (assistant["petting"], assistant["oral"])
END

!Assistant washes slave - Bath Slave Rule - Assistant
IF assistant["energy"] >= 0 and assistant_washe_slave_rule = 1 and bath > 0 and slave["hygiene"] > 0:
 assistant_washs_slave = 1
 slave_auto_bathing = 0
 house_mess_rate += 3
 assistant_rate["hygiene"] = 0
 assistant["hygiene"] = 0
 slave_rate["mood"] += slave["hygiene"]
 slave_rate["hygiene"] = 0
 slave["hygiene"] = 0
 slave["pos_slave_clean"] = 1
END

!Assistant Clean rule
IF assistant_cleans_rule = 1 and house_mess > 1 and assistant["energy"] > 0:
 assistant_auto_clean = 1
 assistant_rate["service"] += 1
 house_mess_rate = 0  
 dynamic '$house_cleaning' 
 assistant["energy"] -= 1
END

!Independent Master Rules - crushboss

!Master will make a meal if no one else does so he eats well - crushboss
IF master_energy >= 0 and cooked_food <= 0 and kitchen > 0:
 master_auto_cook = 1
 $interaction_type = 'special' 
 if cooked_food < master_butler: cooked_food = master_butler
 if master_butler = 6: cooked_food = 5
 master_butler_rate += 1
 house_mess_rate += 5
 master_hygiene_rate += 5 
 master_mood['neg_cook'] = 3 + brand_reputation - master_butler
 dynamic $master_energy_drop
 npc = 0
END

!Master will clean the house if no one else does and it is really messy - crushboss
IF master_energy >= 0 and (house_mess > 3 or house_mess_rate >= 60):
 master_auto_clean = 1
 $interaction_type = 'special' 
 master_butler_rate += 1
 master_mood['neg_cleaning'] = 1 + brand_reputation
 dynamic $master_energy_drop
 master_hygiene_rate += house_mess + 2 
 house_mess_rate -= master_butler*16
 if house_mess < 0: house_mess = 0
 if house_mess_rate < 0: house_mess_rate = 0
 dynamic $house_cleaning 
 npc = 0 
END

!CHECK: crutch for older versions, otherwise the food will be all-time F- level
show_food = 1
gs '#food_base'
gs '$food_choice'

!buying food
food_buy_volume = 5
dynamic $get_frige_space
!and sparks > 50 - assistant will not be wasting money on food if sparks are less than 50, even if the rule is enabled
IF assistant_buy_vegetables = 1 and frige["vegetables"] = 0 and frige_space >= 5 and sparks > 50:
 frige["vegetables"] += 5
 autobuy_cost += 5
 dynamic $get_frige_space
END
IF assistant_buy_flower = 1 and frige["flower"] = 0 and frige_space >= 5 and sparks > 50:
 frige["flower"] += 5
 autobuy_cost += 5
 dynamic $get_frige_space
END
IF assistant_buy_spice = 1 and frige["spice"] = 0 and frige_space >= 5 and sparks > 50:
 frige["spice"] += 5
 autobuy_cost += 5
 dynamic $get_frige_space
END
IF assistant_buy_milk = 1 and frige["milk"] = 0 and frige_space >= 5 and sparks > 50:
 frige["milk"] += 5
 autobuy_cost += 10
 dynamic $get_frige_space
END
IF assistant_buy_cheese = 1 and frige["cheese"] = 0 and frige_space >= 5 and sparks > 50:
 frige["cheese"] += 5
 autobuy_cost += 5
 dynamic $get_frige_space
END
dynamic $get_frige_space
IF assistant_buy_alcohol = 1 and frige["alcohol"] = 0 and frige_space >= 5 and sparks > 50:
 frige["alcohol"] += 5
 autobuy_cost += 10
 dynamic $get_frige_space
END
IF assistant_buy_eggs = 1 and frige["eggs"] = 0 and frige_space >= 5 and sparks > 50:
 frige["eggs"] += 5
 autobuy_cost += 10
 dynamic $get_frige_space
END
IF assistant_buy_cream = 1 and frige["cream"] = 0 and frige_space >= 5 and sparks > 50:
 frige["cream"] += 5
 autobuy_cost += 20
 dynamic $get_frige_space
END
IF assistant_buy_mince = 1 and frige["mince"] = 0 and frige_space >= 5 and sparks > 50:
 frige["mince"] += 5
 autobuy_cost += 7
 dynamic $get_frige_space
END
IF assistant_buy_meat = 1 and frige["meat"] = 0 and frige_space >= 5 and sparks > 50:
 frige["meat"] += 5
 autobuy_cost += 20
 dynamic $get_frige_space
END

IF frige_space < 5 and frige["milk"] > 10: frige["milk"] = 10
dynamic $get_frige_space
IF frige_space < 5 and frige["eggs"] > 15: frige["eggs"] = 10
dynamic $get_frige_space
IF frige_space < 5 and frige["cream"] > 15: frige["cream"] = 10
dynamic $get_frige_space
IF frige_space < 5 and frige["mince"] > 10: frige["mince"] = 10
dynamic $get_frige_space 

!Daily libido changes - crushboss
IF master_mood > 0 and master_libido >= 4 and master_energy >= 0:
 master_libido_rate += 3
 ELSEIF master_mood > 0 and master_libido >= 2 and master_energy >= 0:
  master_libido_rate += 2
 ELSE
  master_libido_rate += 1
END

!Stat adjustments for master - End of day
IF master_energy >= 1: master_libido_rate += master_energy
IF master_energy < 0: master_libido_rate -= 3
IF master_mood < 0: master_libido_rate -= 2
IF master_ill > 6: master_libido_rate -= 5
master_libido_rate -= master_wounds
IF master_excitement = 5 AND chimera_gem_on = 0: master_libido_rate -= 2
IF chimera_gem_on = 1:
 if master_libido < 2: master_libido = 2 & master_libido_rate = 40
 if master_libido_rate < 5: master_libido_rate = 5
 if master_excitement < 5: master_excitement = 5 & master_excitement_rate = 200
 if master_wounds > 0 or master_wounds_rate > 0: master_wounds_rate -= 1
END

!reseting and lowering vars
killvar 'already_done_today'
killvar 'already_gain_virtue'
killvar 'already_gain_assistant'
killvar 'already_gain_prisoner'
auspex = 0
slave["beaten"] = 0
prisoner["beaten"] = 0
assistant["beaten"] = 0
slave["massaged"] = 0
prisoner["massaged"] = 0
assistant["massaged"] = 0
slave["tatoo_timeup"] = 0
prisoner["tatoo_timeup"] = 0
assistant["tatoo_timeup"] = 0
slave['half_action'] = 0
assistant['half_action'] = 0
prisoner['half_action'] = 0
master_half_action = 0
master_massaged = 0
master_spaed = 0
master_erected = 0
master_styled = 0
day += 1
decadecount += 1

gs '$mod_master_drop', 1
gs '$mod_master_rise', 1
gs '$mod_slave_drop', 1
gs '$mod_slave_rise', 1
gs '$mod_global_drop', 1

if raven_crown_on = 1: auspex = 1

!Slave wakes up from fainting / pass_out / unconscious if not dead or starving - slave can recover from stamina loss - crushboss
if slave_state = CONST_INT['slave_faint'] and slave["fat"] > 0 and slave['starvation'] < 10: slave_rate["stamina"] += 1
IF slave_state ! CONST_INT['no_exist'] and slave["stamina"] < 2 and slave['starvation'] < 10 and (master_medic > 3 or assistant['nurse'] > 3):
 slave_rate["stamina"] += 2
 elseif slave_state ! CONST_INT['no_exist'] and slave["stamina"] < 2 and slave['starvation'] < 5:
 slave_rate["stamina"] += 1
END
IF slave_state = CONST_INT['slave_faint'] and slave["stamina"] > 0:
 slave_state = CONST_INT['slave_exist']
 IF slave["stamina"] > 1:
  slave["stamina"] -= 1
  slave_rate["stamina"] = 0
 END
 slave["energy"] = -4
END

!Assistant wakes up from fainting / pass_out / unconscious if not dead or starving - assistant can recover from stamina loss - crushboss
if assistant_state = CONST_INT['slave_faint'] and assistant["fat"] > 0 and assistant['starvation'] < 10: assistant_rate["stamina"] += 1
IF assistant_state ! CONST_INT['no_exist'] and assistant["stamina"] < 2 and assistant['starvation'] < 10 and (master_medic > 3 or assistant['nurse'] > 3):
 assistant_rate["stamina"] += 2
 elseif assistant_state ! CONST_INT['no_exist'] and assistant["stamina"] < 2 and assistant['starvation'] < 5:
 assistant_rate["stamina"] += 1
END
IF assistant_state = CONST_INT['slave_faint'] and assistant["stamina"] > 0:
 assistant_state = CONST_INT['slave_exist']
 IF assistant["stamina"] > 1:
  assistant["stamina"] -= 1
  assistant_rate["stamina"] = 0
 END
 assistant["energy"] = -4
END

!slave part
if slave["makeup"] = 1: slave["makeup"] = 0
if slave["parfume"] = 1: slave["parfume"] = 0
if slave["epilation"] > 0: slave["epilation"] -= 1
if slave["manicure"] > 0: slave["manicure"] -= 1
if slave["hairstyle"] > 0: slave["hairstyle"] -= 1
!removed hair hardcode state, hairfix
!if slave["hairstyle"] > 0: slave["hairstyle_demo"] = 1 

! fixed the typo, by Lyazar
if slave_inventory["parfume"] > 0: slave["parfume"] = 1

!daily bonuses - improved - crushboss
!Slave energy check - no bonuses if the player just clicks 'End of Day' to advance time - crushboss
IF slave["energy"] < 4 and slave_state ! CONST_INT['no_exist']:
 slave_rate["stamina"] += daily_bonus["stamina"]
 slave_rate["sensitivity"] += daily_bonus["sensitivity"]
 slave_rate["temper"] += daily_bonus["temper"]
 slave_rate["intellect"] += daily_bonus["intellect"]
 slave_rate["ego"] += daily_bonus["ego"]
 slave_rate["pride"] += daily_bonus["pride"]
 slave_rate["instinct"] += daily_bonus["instinct"]
 slave_rate["rational"] += daily_bonus["rational"]
 slave_rate["custom"] += daily_bonus["custom"]
 daily_bonus["stamina"] = 0
 daily_bonus["sensitivity"] = 0
 daily_bonus["temper"] = 0
 daily_bonus["intellect"] = 0
 daily_bonus["ego"] = 0
 daily_bonus["pride"] = 0
 daily_bonus["instinct"] = 0
 daily_bonus["rational"] = 0
 daily_bonus["custom"] = 0

 !Slave age count daily increase for keeping track of how long you''ve owned the slave - crushboss
 if slave['age_count'] < 0: slave['age_count'] = 0
 if slave_state = CONST_INT['slave_exist']: slave['age_count'] += 1
 if slave_state = CONST_INT['no_exist']: slave['age_count'] = 0
 if assistant_state = 1: assistant['age_count'] += 1
 if assistant_state ! 1 and assistant['age_count'] > 0: assistant['age_count'] = 0
 if prisoner_state > 0: prisoner['age_count'] += 1
 if prisoner_state = 0 and prisoner['age_count'] > 0: prisoner['age_count'] = 0
 
 !Obedience difficult daily decrease - crushboss 
 IF slave_state = CONST_INT['slave_exist'] and difficulty_setting = 2:
	if slave["moral"] > 2 and slave['obedience_difficulty'] > 6: slave['obedience_difficulty'] = 6
	IF slave['obedience_difficulty'] > 6:
		slave['obedience_difficulty'] -= 1
	elseif slave['obedience_difficulty'] < 6:
		slave['obedience_difficulty'] += 1
	END
 END
 IF assistant_state = CONST_INT['slave_exist'] and difficulty_setting = 2:
	if assistant["moral"] > 2 and assistant['obedience_difficulty'] > 6: assistant['obedience_difficulty'] = 6
	IF assistant['obedience_difficulty'] > 6:
		assistant['obedience_difficulty'] -= 1
	elseif assistant['obedience_difficulty'] < 6:
		assistant['obedience_difficulty'] += 1
	END
 END
 IF prisoner_state = CONST_INT['slave_exist'] and difficulty_setting = 2:
	if prisoner["moral"] > 2 and prisoner['obedience_difficulty'] > 6: prisoner['obedience_difficulty'] = 6
	IF prisoner['obedience_difficulty'] > 6:
		prisoner['obedience_difficulty'] -= 1
	elseif prisoner['obedience_difficulty'] < 6:
		prisoner['obedience_difficulty'] += 1
	END
 END
 
 !Raise interest to the slave
 if slave_state = CONST_INT['slave_exist']: slave['newness'] += 1 + charm/6
 if assistant_state > 0: assistant['newness'] += 1 + assistant_charm/6
!End of energy check - this END statement is needed - do not remove - crushboss
END

if slave_state = CONST_INT['no_exist']: slave['obedience_difficulty'] = 14
if assistant_state = CONST_INT['no_exist']: assistant['obedience_difficulty'] = 14

!daily bonuses for the assistant - added by crushboss
IF slave["energy"] < 4 and assistant_state = 1:
 !Added code to handle item bonuses for the assistant - crushboss
 assistant_rate["stamina"] += daily_bonus_assistant["stamina"]
 assistant_rate["sensitivity"] += daily_bonus_assistant["sensitivity"]
 assistant_rate["temper"] += daily_bonus_assistant["temper"]
 assistant_rate["intellect"] += daily_bonus_assistant["intellect"]
 assistant_rate["ego"] += daily_bonus_assistant["ego"]
 assistant_rate["pride"] += daily_bonus_assistant["pride"]
 assistant_rate["instinct"] += daily_bonus_assistant["instinct"]
 assistant_rate["rational"] += daily_bonus_assistant["rational"]
 assistant_rate["custom"] += daily_bonus_assistant["custom"]
 daily_bonus_assistant["stamina"] = 0
 daily_bonus_assistant["sensitivity"] = 0
 daily_bonus_assistant["temper"] = 0
 daily_bonus_assistant["intellect"] = 0
 daily_bonus_assistant["ego"] = 0
 daily_bonus_assistant["pride"] = 0
 daily_bonus_assistant["instinct"] = 0
 daily_bonus_assistant["rational"] = 0
 daily_bonus_assistant["custom"] = 0
END

!lactation
slave['milk_gain'] = 0
slave['cream_gain'] = 0
IF slave['lactation'] > 0:
 slave['milk_gain'] = slave["boobs"] + slave["stamina"] - 3 + slave['mood'] - slave['angst']
 if slave['age'] = CONST_INT['milf_age']: slave['milk_gain'] += 2
 if slave['fat'] = 0: slave['milk_gain'] = slave['milk_gain']/2
 if slave['fat'] > 1: slave['milk_gain'] += 1
 if slave['fat'] > 2: slave['milk_gain'] += 2
 if slave['fat'] > 3: slave['milk_gain'] += 4
 if slave['fat'] > 4: slave['milk_gain'] += 8  
 slave['cream_gain'] = slave['milk_gain']/3
 slave_rate['custom'] += 1
 slave['lactation'] = 1
 if slave['milk_gain'] > 2: slave['lactation'] = 2
 if slave['milk_gain'] > 5: slave['lactation'] = 3
 if slave['milk_gain'] > 8: slave['lactation'] = 4
 if slave['milk_gain'] > 11: slave['lactation'] = 5  
END

!Calories counting - overhauled by crushboss
slave["calories"] -= 1
food_need = 1
if slave["age"] ! CONST_INT['loli_age']: slave["calories"] -= 1 & food_need += 1
if slave['pregnant'] > 0: slave["calories"] -= 1 & food_need += 1
if slave['egging'] > 0: slave["calories"] -= 2 & food_need += 1
if slave["lactation"] > 0: slave["calories"] -= 1 & food_need += 1
if slave["parasite"] > 0: slave["calories"] -= slave["parasite"]

cal_burn = 0

!nutritionist - part 1 - crushboss
IF slave_food_portion = 4:
 IF slave["fat"] ! 0:
  slave_rate["fat"] = 2
  slave["calories"] = 2
  else
  slave["calories"] = 14
 END
 if slave["fat"] = 0 and slave_rate["fat"] < 8: slave_rate["fat"] = 8
END

IF slave["calories"] > 0 and slave_rate["fat"] >= 1:
 rise_cap = 5 - slave["stamina"]
 food_health_rise = min (rise_cap, slave["calories"], slave["metabolism"])
 slave_rate["stamina"] += food_health_rise
 slave['starvation'] -= 2
 if slave['starvation'] < -14: slave['starvation'] = -14 & slave['neg_hungry'] = 0
 slave["calories"] -= slave["metabolism"]
 if slave["calories"] < 0: slave["calories"] = 0
 cal_burn = 1
END

IF slave["calories"] > 0:
 slave_rate["fat"] += (slave["calories"] + 3) - slave["metabolism"]
 if cal_burn = 0: slave['starvation'] -= 2
END

!removed getting hungry moodlet if the calories are equal to zero
if slave["calories"] = 0: slave['starvation'] -= 1

!nutritionist - part 2 - crushboss
IF slave_food_portion = 4:
 if slave["fat"] ! 0: slave_rate["fat"] = 2
 slave["calories"] = 2
 slave['neg_hungry'] = 0
 slave['starvation'] = -7
 if slave["stamina"] <= 1: slave_rate["stamina"] += 8
 if slave["fat"] = 0: slave_rate["fat"] += 5
END

if slave["calories"] < 0: slave['neg_hungry'] = 1 
 
IF slave["calories"] < 0 and slave["fat"] > 0:
 slave_rate["fat"] -= (slave["metabolism"] + 3)
 slave["calories"] += slave["metabolism"]
 if slave["calories"] > 0: slave["calories"] = 0
 IF slave_rate["fat"] <= -25 and slave["fat"] > 0:
  slave["fat"] -= 1
  slave_rate["fat"] = 0
 END
END

IF slave["calories"] < 0:
 slave['starvation'] += 2
 if slave['starvation'] > 0: slave['neg_hungry'] = slave['starvation']
END

IF slave['starvation'] > 0:
  slave_rate["stamina"] -= (slave['starvation']/2)
END

!Chance of death due to starvation - crushboss
IF slave["calories"] < 0 and slave["fat"] = 0:
 slave_rate["fat"] -= (slave["metabolism"] + 3)
 if slave["fat"] < 0: slave["fat"] = 0
 if slave_rate["fat"] <= 0 and slave["fat"] = 0 and slave['starvation'] > 50: dynamic '$slave_pass_out'
END

!Chance of death due to no stamina and no stamina_rate - crushboss
if prisoner_state = 1 and prisoner["stamina"] = 0 and prisoner_rate["stamina"] <= 0: prisoner_died = 1
if prisoner_state = 1 and prisoner['starvation'] > 50: prisoner_died = 1

slave["calories"] = 0

IF special_food = 1:
 main_slave_ration = slave_ration
 slave_ration = 100
 special_food = 0
END

!lillimerge: added positive mood change of scraps to all food types
!modified requirement for positive mood when given no food
!and fixed indentation for better redability
IF slave_food_type = 0 or slave_food_type = 2: 
 IF slave_food_type = 2 and slave_food_portion > 0:
  slave["neg_slave_food"] = 1
  if slave_eats_remains = 1 and cooked_food > slave["pride"]*2: slave["pos_cookie"] = 1
  if slave["fiend_tattoo"] = 0: slave["neg_disgust"] = 1 + slave["pride"] - slave["preversion"]
  if slave["preversion"] = 2: slave["pos_cookie"] = 1 & slave["neg_slave_food"] = 0
  if slave["fiend_tattoo"] = 1: slave["pos_cookie"] = 1 & slave["neg_slave_food"] = 0
  slave["preversion_xp"] += 1 
 END
 IF slave_food_type = 0 and slave_food_portion > 0:
  slave["neg_slave_food"] = 1
  if slave_eats_remains = 1 and cooked_food > slave["pride"]*2: slave["pos_cookie"] = 1
 END
 IF slave_food_portion = 0:
  if slave_eats_remains = 1 and cooked_food > slave["pride"]*3: slave["pos_cookie"] = 1
 END
ELSE
 IF slave_food_portion = 0:
  if slave_eats_remains = 1 and cooked_food > slave["pride"]*3: slave["pos_cookie"] = 1
 ELSE
  if slave_eats_remains = 1 and cooked_food > slave["pride"]: slave["pos_cookie"] = 1
 END
END

!Added benefits and penalties to Eat my leftovers given to slaves - crushboss
IF slave_eats_remains = 1:
 slave_rate["mood"] += slave["moral"]
 slave_rate["mood"] -= slave["pride"]
 IF slave["moral"] = 0:
  slave_rate["spoil"] += slave['sensitivity']*5
  elseif slave["moral"] = 1:
   slave_rate["spoil"] += slave['sensitivity']*2
  elseif slave["moral"] >= 2 and slave["moral"] < 5:
   slave_rate["spoil"] += 1
 END
 slave["energy"] += 1
 slave_rate["stamina"] += 1
 IF slave["pride"] < 2 and slave["angst"] <= 0 and slave["mood"] > 3 and slave["moral"] >= 2:
  slave_rate["moral"] += 1
  slave_rate["instinct"] += 1
  slave["pos_cookie"] = 1
 END
END

!Fixed a nasty rational drain bug with the code fix below - crushboss
if slave['starvation'] > 0: slave_rate["rational"] += (slave['starvation']/2)

eaten_food = 0
if slave_food_portion = 1: eaten_food = food_need + slave["stamina"] - slave["metabolism"]
if slave_food_portion = 2: eaten_food = food_need + slave["stamina"] + slave["metabolism"]
if slave_food_portion = 4: eaten_food = food_need + slave["stamina"] + slave["metabolism"]
IF slave_food_portion = 3 or slave_ration = 100:
 eaten_food = food_need + slave["stamina"] + slave["metabolism"] + 2
 if slave["passion_sweets"] > 0: eaten_food += 2
 if slave['mood'] < 0: eaten_food -= slave['mood'] + slave['angst']
 if slave_food_type ! 2: slave_rate['custom'] -= 1
END
IF slave_ration = 100: slave["pos_cookie"] = 2 
slave_ration = 0

slave["calories"] = eaten_food
slave_food_cost = 0
if slave_food_type = 0: slave_food_cost = eaten_food

!Added benefits and penalties to Fresh Food given to slaves - crushboss
IF slave_food_type = 1:
 slave_food_cost = eaten_food*2
 slave_rate["stamina"] += 1
 if slave["angst"] < 3: slave_rate["mood"] += (1 + (slave['sensitivity']/2))
 IF slave["moral"] = 0:
  slave_rate["spoil"] += slave['sensitivity']*3
  elseif slave["moral"] >= 1 and slave["moral"] < 4:
   slave_rate["spoil"] += 1
 END
END

IF slave_food_type = 2: 
 IF spawn_semen > eaten_food:
  spawn_semen -= eaten_food
  else
  slave_food_cost += eaten_food - spawn_semen
  spawn_semen = 0
 END
END
if slave_eats_remains = 1: slave["calories"] += RAND(0,3)
food_cost = slave_food_cost/3

IF slave_food_portion = 4: food_cost + 5

IF vitamin = 1:
 if master_medic > slave["stamina"]: slave_rate["stamina"] += 1
 food_cost += 1
END

!Added stamina bonus for supplements with nutritionist - crushboss
if vitamin = 1 and slave_food_portion = 4 and master_medic < slave["stamina"]: slave_rate["stamina"] += 1

if slave['starvation'] > slave['stamina'] and slave_rate["fat"] <= 0 and (slave_food_portion ! 4 or slave_food_portion <= 0): starvation_warning = 1
if slave_food_portion = 4: starvation_warning = 0
if slave_state ! CONST_INT['no_slave']: total_food_cost += food_cost

!healing and dependence
IF slave['koffed'] > 0:
 slave['koffed'] = 0
 a = slave['stamina']*10
 if slave['koffe_addiction'] > a: slave['energy'] -= 1 & slave['neg_slave_koffe'] = 1
 slave['koffe_addiction'] += 1
END
IF slave['on_alco'] > 0:
 slave['on_alco'] = 0
 slave['dipsomania'] += 1
 slave['pos_slave_alco'] = 0
 slave['neg_slave_alco'] = slave['dipsomania']
 else
 if slave['dipsomania'] > 0: slave['dipsomania'] -= 1
END
if slave['dipsomania'] >= slave['stamina']: slave_rate['stamina'] -= slave['dipsomania']

IF slave['on_meth'] > 0:
 slave['on_meth'] = 0
 slave['pos_slave_meth'] = 0
 if slave['meth_addiction'] > slave['stamina']: slave['neg_slave_meth'] = slave['meth_addiction']
 slave['meth_addiction'] += 1
 slave_rate['stamina'] -= 1
 else
 a = RAND(1,3)
 if a = 1 and slave['meth_addiction'] > 0: slave['meth_addiction'] -= 1
 slave_rate['stamina'] -= slave['meth_addiction']
END

IF slave['on_opium'] > 0:
 slave['on_opium'] = 0
 slave['pos_slave_opium'] = 0
 if slave['opium_addiction'] > slave['stamina']: slave['neg_slave_opium'] = slave['opium_addiction']
 slave['opium_addiction'] += 1
 slave_rate['stamina'] -= 1
 else
 a = RAND(1,3)
 if a = 1 and slave['opium_addiction'] > 0: slave['opium_addiction'] -= 1
 slave_rate['stamina'] -= slave['opium_addiction']
END

slave_healing = master_medic + assistant["nurse"]
if slave_healing > 0: slave_rate["bruises"] -= slave["stamina"] + slave_healing

IF slave_rate["wounds"] > 0:
 slave_rate["wounds"] -= slave["stamina"] + slave_healing - slave["hygiene"]
 slave_rate["scares"] += slave["wounds"]
 slave['neg_sick'] = 1
END
IF slave_rate["wounds"] < 0: slave_rate["wounds"] = 0

!Added chance for scarring for slave - crushboss
IF (slave_rate["wounds"] >= 40 and slave_rate["wounds"] < 100) or slave["wounds"] = 2 or slave["wounds"] = 3:
 a = RAND(1,10)
 if a > 4: slave["scares"] += 1
 a = 0
 ELSEIF (slave_rate["wounds"] >= 100 and slave_rate["wounds"] < 120) or slave["wounds"] = 4:
  a = RAND(1,10)
  if a > 4: slave["scares"] += 1
  if a > 7: slave["scares"] += 1
  a = 0
 ELSEIF slave_rate["wounds"] >= 120 or slave["wounds"] = 5:
  a = RAND(1,10)
  if a > 4: slave["scares"] += 1
  if a > 6: slave["scares"] += 1
  if a > 8: slave["scares"] += 1
  a = 0
END

!Added chance for scarring for assistant - crushboss
IF (assistant_rate["wounds"] >= 40 and assistant_rate["wounds"] < 100) or assistant["wounds"] = 2 or assistant["wounds"] = 3:
 a = RAND(1,10)
 if a > 4: assistant["scares"] += 1
 a = 0
 ELSEIF (assistant_rate["wounds"] >= 100 and assistant_rate["wounds"] < 120) or assistant["wounds"] = 4:
  a = RAND(1,10)
  if a > 4: assistant["scares"] += 1
  if a > 7: assistant["scares"] += 1
  a = 0
 ELSEIF assistant_rate["wounds"] >= 120 or assistant["wounds"] = 5:
  a = RAND(1,10)
  if a > 4: assistant["scares"] += 1
  if a > 6: assistant["scares"] += 1
  if a > 8: assistant["scares"] += 1
  a = 0
END

IF slave['ill'] > 0:
 slave['ill'] += 1
 if slave['ill'] > slave['stamina']: slave_rate['stamina'] -= 1
 if slave['ill'] > 6: slave['neg_slave_ill'] = slave['ill']  
END

IF slave['parasite'] > 0:
 slave_rate['arousal'] += slave['parasite'] * 10
 slave['parasite'] += 1
END

!Menstrual cycle and pregnancy - slave - improved and fixed - crushboss
IF slave["age"] = CONST_INT['loli_age']: slave['fertility'] = -2
IF slave['fertility'] < 0:
	slave['parasite'] = 0
	slave['pregnant'] = 0
END
IF assistant['fertility'] < 0:
	assistant['parasite'] = 0
	assistant['pregnant'] = 0
END
if slave['vaginal_modification'] = 4: slave['parasite'] = 0
if assistant['vaginal_modification'] = 4: assistant['parasite'] = 0
slave['cycle_day'] += 1
if slave['cycle_day'] > 28: slave['cycle_day'] = 1
IF slave['pregnant'] = 0: 
 IF slave["age"] ! CONST_INT['loli_age'] and slave_state ! CONST_INT['no_slave']:
  if slave['ovulation'] > 0: slave['ovulation'] -= 1
  if slave['ovulation'] < 0: slave['ovulation'] = 0
  IF slave['cycle_day'] = 1:
   slave['neg_menstruation'] = 6 - slave['stamina']
   menstruation = 1
  END
  if slave['cycle_day'] = 9: slave['ovulation'] = 7
 END
 ELSE
 slave['pregnant'] += 1 
 slave_rate['stamina'] -= 1
 if slave['pregnant'] > 0: slave['ovulation'] = 0 
END

!Egglaying - slave
slave['egg_time'] = 0
IF slave['pregnant'] > 3 and slave['fertility'] = 1:
 IF slave['eggs_to_lay'] = 0:
  virginity = 3
  a = RAND (3,6)
  slave['eggs_to_lay'] = slave["age"] + slave["stamina"] + a + slave['fat']
 END
 if slave['eggs_to_lay'] = 1: slave['pregnant'] = 0
 slave['eggs_to_lay'] -= 1
 slave['egg_time'] = 1
 slave_rate['custom'] += 1  
 if virginity < 2: virginity = 2  
END

!Change stats under the influence of the established rules

!Clear the rules if no slave exists - crushboss
IF slave_state = CONST_INT['no_slave']:
 silence_rule = 0
 master_rule = 0
 rule_masturbation = 0
 orgasm_prohibited = 0
 shit_prohibited = 0
 pet_rule = 0  
 blowjob_rule = 0
 pissuar_rule = 0
 toilet_rule = 0
 slave_cleans_rule = 0  
 slave_cooks_rule = 0
 slave_washes_rule = 0
 slave_tentacle_rule = 0
 v_balls_rule = 0
 force_rules = 0
 slave_account_rule = 0
END

$force_msg  = ''

!Ensure all variables are set to zero - sanity check - probably unnecessary - crushboss
rules_broken = 0
rules_count = 0
num_rules_broken = 0
num_rules_wanttobreak = 0
silence_rule_res = 0
master_rule_res = 0
shit_prohibited_res = 0
pet_rule_res = 0
blowjob_rule_res = 0
pissuar_rule_res = 0
toilet_rule_res = 0
v_balls_rule_res = 0
iwanttobreakbutcant_silence_rule = 0
iwanttobreakbutcant_master_rule = 0
iwanttobreakbutcant_shit_prohibited = 0
iwanttobreakbutcant_pet_rule = 0
iwanttobreakbutcant_blowjob_rule = 0
iwanttobreakbutcant_pissuar_rule = 0
iwanttobreakbutcant_toilet_rule = 0
iwanttobreakbutcant_v_balls = 0
unenforced_silence_rule_broken = 0
unenforced_master_rule_broken = 0
unenforced_shit_prohibited_broken = 0
unenforced_pet_rule_broken = 0
unenforced_blowjob_rule_broken = 0
unenforced_pissuar_rule_broken = 0
unenforced_toilet_rule_broken = 0
unenforced_v_balls_rule_broken = 0

!Rewrote most of the rule code - was a total mess - crushboss
!rule_masturbation is not handled here but later in next_day and end_day_screen - crushboss
!orgasm_prohibited rule is not handled here but in #dynamic, sexy_time_engine, and end_day_screen - crushboss
!All the other rules that require special handling are handled in this section - crushboss

!Beginning of slave energy check - rules will not gain bonuses or penalties if the player just clicks 'End of Day' to advance time - crushboss
IF slave["energy"] < 4 and slave_state ! CONST_INT['no_exist']:
IF silence_rule = 1: 
 silence_rule_res = slave["obedience"] - slave["temper"]
 rules_count += 1
 IF force_rules = 1 and inventory['secure_gag'] = 1: 
  IF silence_rule_res < 0:
   slave['neg_rules'] = 1
   iwanttobreakbutcant_silence_rule = 1
   num_rules_wanttobreak += 1
  END
  slave_rate["mood"] -= slave["temper"] - slave["moral"] 
  $force_msg += 'Кляп работает <br>'
 END
 IF silence_rule_res < 0 and iwanttobreakbutcant_silence_rule ! 1:
  unenforced_silence_rule_broken = 1
  num_rules_broken += 1
 END
END
IF master_rule = 1:
 master_rule_res = slave["obedience"] - slave["pride"] - 1
 rules_count += 1
 IF force_rules = 1: 
  IF master_rule_res < 0:
   slave['neg_rules'] = 1
   iwanttobreakbutcant_master_rule = 1
   num_rules_wanttobreak += 1
  END   
  slave_rate["mood"] -= slave["ego"] + slave["pride"] - slave["moral"]
 END
 IF master_rule_res < 0 and iwanttobreakbutcant_master_rule ! 1:
  unenforced_master_rule_broken = 1
  num_rules_broken += 1
 END
END
IF shit_prohibited = 1:
 shit_prohibited_res = slave["obedience"] + slave["preversion"] + master_supermacy - slave["ego"] - slave["pride"]
 rules_count += 1
 IF force_rules = 1 and inventory['anal_plug'] > 0: 
  IF shit_prohibited_res < 0:
   slave['neg_rules'] = 1
   iwanttobreakbutcant_shit_prohibited = 1
   num_rules_wanttobreak += 1
  END
  slave_rate["mood"] -= slave["ego"] - slave["moral"]
 END
 IF shit_prohibited_res < 0 and iwanttobreakbutcant_shit_prohibited ! 1:
  unenforced_shit_prohibited_broken = 1
  num_rules_broken += 1
 END
END
IF pet_rule = 1:
 pet_rule_res = slave["obedience"] + slave["pet_affinity"] + slave["pet"] - slave["ego"] - slave["pride"]
 rules_count += 1 
 IF force_rules = 1 and inventory['petsuit'] > 0: 
  IF pet_rule_res < 0:
   slave['neg_rules'] = 1
   iwanttobreakbutcant_pet_rule = 1
   num_rules_wanttobreak += 1
  END
  slave_rate["mood"] -= slave["ego"] + slave["pride"] - slave["moral"]
 END
 IF pet_rule_res < 0 and iwanttobreakbutcant_pet_rule ! 1:
  unenforced_pet_rule_broken = 1 
  num_rules_broken += 1
 END
END
IF blowjob_rule = 1:
 blowjob_rule_res = slave["obedience"] + slave["sub_bj"] + slave["nymphomania"] + slave["arousal"] - slave["pride"] - 4
 rules_count += 1 
 IF force_rules = 1: 
  IF blowjob_rule_res < 0:
   slave['neg_rules'] = 1
   iwanttobreakbutcant_blowjob_rule = 1
   num_rules_wanttobreak += 1
  END
  slave_rate["mood"] -= 5 + slave["temper"] + slave["pride"] + slave["ego"] + slave["angst"] - slave["moral"] - slave["sub_bj"] - slave["instinct"] - slave["custom"] - slave["nymphomania"] - slave["preversion"] - slave["meekness"]
 END
 IF blowjob_rule_res < 0 and iwanttobreakbutcant_blowjob_rule ! 1:
  unenforced_blowjob_rule_broken = 1  
  num_rules_broken += 1
 END
END
IF pissuar_rule = 1:
 pissuar_rule_res = slave["obedience"] + slave["sub_piss"] + slave["preversion"] - slave["pride"] - slave["ego"] - 3
 rules_count += 1
 IF force_rules = 1 and inventory['pissuar_stable'] = 1: 
  IF pissuar_rule_res < 0:
   slave['neg_rules'] = 1
   iwanttobreakbutcant_pissuar_rule = 1
   num_rules_wanttobreak += 1
  END    
  slave_rate["mood"] -= 3 + slave["ego"] + slave["pride"] - slave["moral"] - slave["sub_piss"]
 END
 IF pissuar_rule_res < 0 and iwanttobreakbutcant_pissuar_rule ! 1:
  unenforced_pissuar_rule_broken = 1 
  num_rules_broken += 1
 END
END
IF toilet_rule = 1:
 toilet_rule_res = slave["obedience"] + slave["sub_kopro"] + slave["preversion"] - slave["pride"] - slave["ego"] - 6
 rules_count += 1 
 IF force_rules = 1 and inventory['toilet_stable'] = 1: 
  IF toilet_rule_res < 0:
   slave['neg_rules'] = 1
   iwanttobreakbutcant_toilet_rule = 1
   num_rules_wanttobreak += 1
  END
  slave_rate["mood"] -= 6 + slave["ego"] + slave["pride"] - slave["moral"] - slave["sub_kopro"]
 END
 IF toilet_rule_res < 0 and iwanttobreakbutcant_toilet_rule ! 1:
  unenforced_toilet_rule_broken = 1
  num_rules_broken += 1
 END
END
IF v_balls_rule = 1:
 v_balls_rule_res = slave["obedience"] + slave["sub_vaginal"] + slave["nymphomania"] + slave["preversion"] - slave["pride"] - slave["ego"] - 2
 rules_count += 1
 IF force_rules = 1:
  IF v_balls_rule_res < 0:
   slave['neg_rules'] = 1
   iwanttobreakbutcant_v_balls = 1
   num_rules_wanttobreak += 1
  END
  slave_rate["mood"] -= 4 + slave["pride"] + slave["ego"] - slave["moral"] - slave["sub_vaginal"]
 END
 IF v_balls_rule_res < 0 and iwanttobreakbutcant_v_balls ! 1:
  unenforced_v_balls_rule_broken = 1
  num_rules_broken += 1
 END
END
if rule_masturbation = 1: rules_count += 1
if orgasm_prohibited = 1: rules_count += 1
if slave_cleans_rule = 1: rules_count += 1
if slave_cooks_rule = 1: rules_count += 1
if slave_tentacle_rule = 1: rules_count += 1
if slave_washes_rule = 1: rules_count += 1
if force_rules = 1: rules_count += 1
!15 rules total - crushboss

!Handle results when slave breaks one or more rules - crushboss
IF num_rules_broken > 0:
 rules_broken = 1
 rules_broken_message = 1
 else
 rules_broken = 0
 rules_broken_message = 0 
END

IF rules_broken = 1:
 sin_potential = max (1, slave["obedience"])
 dynamic $sin_gained_now
 IF slave["sin"] > 1: 
  slave_rate["custom"] -= num_rules_broken
  slave_rate["instinct"] -= slave["temper"]
  slave_rate["rational"] -= slave["ego"]
 END
 IF silence_rule = 1 and unenforced_silence_rule_broken = 1:
  slave_rate["expression"] += 1
  slave_rate["temper"] += 1
  slave_rate["ego"] += 1  
 END
 IF master_rule = 1 and unenforced_master_rule_broken = 1:
  slave_rate["pride"] += 5
  slave_rate["ego"] += 1  
 END
 IF shit_prohibited = 1 and unenforced_shit_prohibited_broken = 1:
  slave_rate["pride"] += 5
  slave_rate["ego"] += 1
 END
 IF pet_rule = 1 and unenforced_pet_rule_broken = 1:
  slave_rate["pride"] += 5 
  slave_rate["ego"] += 1
 END
 IF blowjob_rule = 1 and unenforced_blowjob_rule_broken = 1:
  slave_rate["pride"] += 5 
  slave_rate["ego"] += 1
 END
 IF pissuar_rule = 1 and unenforced_pissuar_rule_broken = 1:
  slave_rate["pride"] += 5 
  slave_rate["ego"] += 1
 END
 IF toilet_rule = 1 and unenforced_toilet_rule_broken = 1:
  slave_rate["pride"] += 5 
  slave_rate["ego"] += 1
 END
 IF v_balls_rule = 1 and unenforced_v_balls_rule_broken = 1:
  slave_rate["pride"] += 2
  slave_rate["ego"] += 1  
 END
END

!Bonuses and adjustments for Rules followed - crushboss
IF silence_rule = 1 and silence_rule_res >= 0:
 slave_rate["custom"] += 1  
 slave_rate["sensitivity"] += 1
 slave_rate["temper"] -= 1
 slave_rate["pride"] -= 2
 if slave["expression"] < master_artdirector: slave_rate["expression"] += 1
END
IF master_rule = 1 and master_rule_res >= 0:
 IF master_supermacy > 2:
  slave_rate["instinct"] += (master_supermacy/2)
  slave_rate["rational"] += (master_supermacy/2)
  else
  slave_rate["instinct"] += 1
  slave_rate["rational"] += 1
 END
 slave_rate["pride"] -= 1
END
IF shit_prohibited = 1 and shit_prohibited_res >= 0:
 slave_rate["stamina"] -= 1
 slave_rate["custom"] += 2
 if master_supermacy > 0: slave_rate["pride"] -= master_supermacy
 if master_supermacy <= 0: slave_rate["pride"] -= 1  
END
IF pet_rule = 1 and pet_rule_res >= 0:
 slave_rate["custom"] += 1 
 slave_rate["ego"] -= 1
 slave_rate["callisthenics"] += 1
 slave_rate["pet"] += 2
 slave_rate["dressage"] += 1
 if master_supermacy > 0: slave_rate["pride"] -= master_supermacy
 if master_supermacy <= 0: slave_rate["pride"] -= 1   
 slave_rate["hygiene"] += 10  
 if slave["pet"] >= brand_reputation AND slave["pet"] > 0: master_mood['pos_good_pet'] = 1
END
IF blowjob_rule = 1 and blowjob_rule_res >= 0:
 if master_excitement > 0: master_mood_rate += slave["sub_bj"]
 if slave["sub_bj"] > 1 and master_excitement > 0: master_mood['pos_good_morning'] = 1
 master_excitement_rate -= slave["sub_bj"]
 slave["sub_bj_xp"] += 1
 slave_concentration += 1
 slave_rate["custom"] += 1
 slave_rate["rational"] += 1
 slave_rate["instinct"] += 1
 slave_rate["pride"] -= 1
 slave_rate["hygiene"] += 5 
END
IF pissuar_rule = 1 and pissuar_rule_res >= 0:
 master_mood_rate += slave["sub_piss"] - 3
 if slave["preversion"] < 1: slave['neg_disgust'] = 1
 if slave["sub_piss"] > 2: master_mood['pos_toilet'] = 1
 slave["sub_piss_xp"] += 1
 slave["preversion_xp"] += 1
 slave_rate["mood"] -= 4 - slave["sub_piss"] - slave["moral"] + slave["preversion"]
 if slave["sub_piss"] < 4 and slave["preversion"] < 1: slave["neg_rules"] = 1
 slave_rate["custom"] += 2 
 if slave["sub_piss"] < 3: slave["sub_piss"] += 1
 if master_supermacy > 0: slave_rate["pride"] -= master_supermacy * slave["pride"]
 if master_supermacy <= 0: slave_rate["pride"] -= slave["pride"]     
 slave_rate["hygiene"] += 15  
 slave_rate['stamina'] -= 2
 slave_rate["angst"] += (slave["ego"] + slave["pride"] + slave["temper"]) - (slave["preversion"] + slave["sub_piss"] + slave["moral"] + slave["instinct"])
END
IF toilet_rule = 1 and toilet_rule_res >= 0:
 if slave["preversion"] < 2: slave['neg_disgust'] = 1
 master_mood_rate += slave["sub_kopro"] - 3
 slave["preversion_xp"] += 1  
 if slave["sub_kopro"] > 3: master_mood['pos_toilet'] += 1  
 slave_rate["mood"] -= 5 - slave["sub_kopro"] - slave["moral"] + slave["preversion"]
 if slave["sub_kopro"] < 4 and slave["preversion"] < 2: slave["neg_rules"] = 1  
 slave_rate["custom"] += 3 
 if slave["sub_kopro"] < 3: slave["sub_kopro"] += 1
 if master_supermacy > 0: slave_rate["pride"] -= master_supermacy * slave["pride"] * 2
 if master_supermacy <= 0: slave_rate["pride"] -= slave["pride"] * 2   
 slave_rate["hygiene"] += 40 
 slave_rate['stamina'] -= (6 + slave['stamina'])
 slave_rate["angst"] += (slave["ego"] + slave["pride"] + slave["temper"]) - (slave["preversion"] + slave["sub_kopro"] + slave["moral"] + slave["instinct"])
END
IF v_balls_rule = 1 and v_balls_rule_res >= 0:
 slave["sub_vaginal_xp"] += 1
 slave_rate["arousal"] += 3
 slave_rate["sensitivity"] += 1
 slave_rate["pride"] -= 1 
 slave_rate["hygiene"] += 5 
END 

!Penalties and Bonuses for forcing rules that the slave hates - crushboss
IF num_rules_wanttobreak > 0:
 slave_rate["angst"] += num_rules_wanttobreak*5
 slave_rate["moral"] -= num_rules_wanttobreak*5
 slave_rate["rational"] += num_rules_wanttobreak
 slave_rate["pride"] -= num_rules_wanttobreak*3
 slave_rate["custom"] += num_rules_wanttobreak
END

!rest conditions
IF slave_sleep_condition = -2:
 if slave["deprivation_attitude"] = -1: 
  if slave["sin"] < 3: slave_rate["angst"] += 10
  if slave["sin"] > 2: slave_rate["rational"] += 5
  gs '$mod_slave_drop', 5
  if slave['fear'] < 5: slave['fear'] += 1
 end 
 if slave["deprivation_attitude"] = 0: 
  if slave["sin"] < 3: slave_rate["angst"] += slave['sensitivity'] + slave['temper']  
  if slave["sin"] > 2: slave_rate["rational"] += (slave['sensitivity'] + slave['temper'])/2
  if slave["fear"] < 2: slave['fear'] += 1
  gs '$mod_slave_drop', 2
 end
 if slave["deprivation_attitude"] = 1: 
  if slave["sin"] < 1: slave_rate["angst"] += slave['temper']  
  if slave["sin"] > 1: slave_rate["rational"] += slave['temper']/2  
  if slave["fear"] < 1: slave["fear"] = 1
 end
 IF slave["deprivation_attitude"] = 2: 
  if slave["fear"] > 0: slave["fear"] -= 1
  else
  if slave['sensitivity'] > 0: slave['neg_bad_sleep'] = 1
  if slave['neg_prisoner'] <= 0: slave['neg_prisoner'] = slave['temper']
  slave_rate["custom"] += 3
 end
 slave["energy"] -= 1  
 slave_rate["stamina"] -= 3
 slave["deprivation_xp"] += 1 
 IF rules_broken = 1: 
  slave["sin"] = 1  
  if sententia_veritas = 1: slave["sin"] = 5
  else
  slave["sin"] = 0 
 END
END

IF slave_sleep_condition = -1:
 slave_rate["mood"] -= 1 + slave['sensitivity']
 slave_rate["custom"] += 2
 slave_rate["instinct"] += 2
 slave["energy"] -= 1  
 slave_rate["stamina"] -= 1
 if slave['sensitivity'] > 1: slave['neg_bad_sleep'] = 1 
END

IF slave_sleep_condition = 0:
 slave_rate["custom"] += 1
 if slave['sensitivity'] > 3: slave['neg_bad_sleep'] = 1 
END

!Sleep (in my bed) with slaver in master bedroom - improved - crushboss
IF slave_sleep_condition = 1:
 slave_rate["mood"] += (slave["moral"]*2)
 slave_rate["mood"] -= slave["pride"]
 slave_rate["mood"] -= slave["angst"]
 IF slave["moral"] = 0:
  slave_rate["angst"] += slave['sensitivity']*5
  elseif slave["moral"] = 1:
   slave_rate["angst"] += slave['sensitivity']*2
  elseif slave["moral"] >= 2:
   slave_rate["moral"] += 1
 END
 slave["energy"] += 1
 IF slave["pride"] < 2 and slave["angst"] <= 0 and slave["mood"] > 3 and slave["moral"] >= 2:
  slave_rate["moral"] += 1
  slave_rate["instinct"] += 1
  slave['pos_sleep'] = 1
 END
END

!Slave sleeps in boudoir - improved - crushboss
IF slave_sleep_condition = 2:
 if slave["angst"] < 3: slave_rate["mood"] += slave['sensitivity']
 if slave['sensitivity'] > 0: slave['pos_sleep'] = 1  
 slave["energy"] += 1  
 slave_rate["instinct"] += 1
 IF slave["moral"] = 0:
  slave_rate["spoil"] += slave['sensitivity']*5
  elseif slave["moral"] >= 1 and slave["moral"] < 4:
   slave_rate["spoil"] += 1
 END
END

!Obtain/reduce Angst - improved - crushboss
IF slave["mood"] < 0:
 angst_rise = 6 - slave["sensitivity"] + slave["mood"]
 if angst_rise < 0: slave_rate["angst"] += slave["sensitivity"]
 else
 slave_rate["angst"] -= ((slave["moral"]*4) + (slave["instinct"]*3) + (slave["rational"]*2) + (slave["custom"]*2))
END

!Angst does the dirty work
if $slave_psy_status = 'depresive': slave_rate["angst"] += 3

IF slave["angst"] > 0:
 slave_rate["temper"] -= slave["angst"]
 slave_rate["ego"] -= slave["angst"]
END

a = slave["stamina"] - slave["wounds"]
if a < 1 and master_medic > slave["wounds"]: a = 1
slave["energy"] += a
if slave["energy"] > 5: slave["energy"] = 5
if slave["energy"] < -5: slave["energy"] = -5

IF slave["energy"] = -5 and slave["stamina"] > 0:
 slave["energy"] = -4
END

IF slave["angst"] > 0: 
 gs '$mod_slave_drop', slave["angst"]
 if slave["angst"] > slave["temper"]: slave["neg_angst"] = slave["angst"]
END

!Lowering fear - improved - crushboss
IF slave["moral"] > slave["fear"] and slave["fear"] > 0 and slave["mood"] > 0:
 slave["fear"] -= 1
 slave_rate["fear"] = 0
 elseif slave["moral"] > 0 and slave["fear"] > 0 and slave["mood"] > 0:
 slave_rate["fear"] -= (slave["moral"]*10)
END

!Reduce the mood because of fear
IF slave["fear"] > slave["custom"] and slave["fear"] > slave["ego"] and slave["fear"] > slave["pride"]:
 if slave["fear"] > slave["instinct"]: slave["neg_fear"] = 1
END

gs '$difficulty_setting'

!Spoil increase if too many rewards are given out per day - slaves should not expect a reward every time they obey - crushboss
if daily_reward_count > 2: slave_rate["spoil"] += (daily_reward_count * 5)

!Spoil increase if not enough rules are enabled per day - slaves do not respect a master who does not expect them to follow any rules - crushboss
if rules_count < 3: slave_rate["spoil"] += (slave["pride"] + slave["ego"] + slave["temper"])

!Too high of spoiling causes obedience to fade - crushboss
IF slave["spoil"] > 3:
	slave_rate["custom"] -= 2
	slave_rate["rational"] -= 2
	slave_rate["instinct"] -= 2
	slave_rate["moral"] -= 4
END

!lowering spoil - improved - crushboss
if slave_rate["spoil"] > 0 or slave["spoil"] > 0 and rules_count > 2: slave_rate["spoil"] -= (1 + slave["fear"] + slave["moral"] + slave["angst"])
if (slave_rate["spoil"] > 0 or slave["spoil"] > 0) and slave["mood"] < 0 and rules_count > 2: slave_rate["spoil"] -= slave["sensitivity"]
if slave["spoil"] < 0: slave["spoil"] = 0
if slave["spoil"] = 0 and slave_rate["spoil"] < -10: slave_rate["spoil"] = -10

!counting arousal and mood
slave_rate["mood"] += slave["moral"] + (slave["stamina"] - 3) + slave["energy"] + daily_bonus["mood"] - slave["arousal"] - slave["fear"] - slave["spoil"] - slave["angst"] - slave["hygiene"] - (house_mess - 1) - slave["mood"]

if slave['moral'] > 0: slave['pos_moral'] = slave['moral']
if slave['angst'] > 0: slave['neg_angst'] = slave['angst']
if slave["spoil"] > 0 and slave["spoil"] > slave["mood"]: slave["neg_spoil"] = 1

!Overhauled arousal calculation and modifiers - crushboss
arousal_modifier = 0
if slave["nymphomania"] > 0: arousal_modifier += ((slave["temper"] + slave["sensitivity"] + slave["mood"])/2)
if slave["nymphomania"] < 0: arousal_modifier -= ((slave["temper"] + slave["sensitivity"] + slave["mood"])/2)
slave_rate["arousal"] += slave["stamina"] + daily_bonus["arousal"] + slave["energy"] + slave["temper"] + slave["mood"] + slave["moral"] + arousal_modifier - (6 + slave["angst"] + slave["pride"] + slave["fear"] + slave["spoil"]) 
if slave["arousal"] > 5: slave["arousal"] = 5
if slave_rate["arousal"] > 200: slave_rate["arousal"] = 200

a = ((slave['pos_orgasm'] + slave['ego'] + slave['pride'] + slave['temper'] + slave['sensitivity'])/3)
if slave["arousal"] > 0 and a < slave["arousal"]: slave['neg_horny'] = 1
if slave["nymphomania"] > 1 and slave["arousal"] > 0: slave['neg_horny'] = 1
if slave["nymphomania"] < 0: slave['neg_horny'] = 0
if slave['pos_orgasm'] > 0: slave['pos_orgasm'] -= 1
if slave['pos_orgasm'] < 0: slave['pos_orgasm'] = 0

!Growing moral - i.e. Daily Devotion Bonus - improved - crushboss
moral_app = min (slave["moral"], slave["custom"], slave["rational"], slave["instinct"])
IF slave["angst"] < 1 and slave["mood"] > 0 and moral_app = slave["moral"] and slave["spoil"] < 3 and slave["fear"] < 5 and slave["pride"] < 5 and rules_count > 2 and daily_reward_count < 3:
 moral_basis = (slave["custom"] + slave["rational"] + slave["instinct"])/3
 moral_boost = min (slave["mood"], moral_basis)
 if moral_boost < 1: moral_boost = 1
 slave_rate["moral"] += moral_boost
END

!Training bonuses for easy obedience difficulty - crushboss
IF difficulty_setting = 1:
	moral_basis = ((master_str + master_domination + master_fighter + master_cha)/5)
	if moral_basis < 1: moral_basis = 1
	slave_rate["moral"] += moral_basis
	slave_rate["custom"] += 1
	slave_rate["rational"] += 1
	slave_rate["instinct"] += 1
	slave_rate["spoil"] -= 5
	slave_rate["angst"] -= 5
END

daily_reward_count = 0

!Lowering moral progress if the slave is severely mishandled - crushboss
if slave["angst"] > 4 and slave["fear"] > 4 and slave["mood"] < 0 and slave["pride"] > 1: slave_rate["moral"] -= (slave["pride"] + slave["ego"] + slave["temper"])

!Lower Slave Mood when obedience, devotion, habit, instinct, and awareness are low and the slaves mood is high - crushboss
IF slave["mood"] > 2 and slave["moral"] < 2:
 IF slave["rational"] <= 3 or slave["instinct"] <= 2 or slave["custom"] <= 3 or slave["moral"] < 1:
  slave_rate["mood"] -= (slave["pride"] + slave["temper"] + slave["ego"])
 END
END

!brand effect
slave['brand'] = tattoo_brand
if slave['brand'] > 0: slave_rate["custom"] += 1
if slave['brand'] = 3: slave_rate["custom"] += 1

!chance of dying at zero value health
!base - 14% - min 6% max 20%
IF slave_state = CONST_INT['slave_faint'] and slave["stamina"] = 0:
 dprob_max = 7
! psy status affect the chance
 if $slave_psy_status = 'servile' or $slave_psy_status = 'obedient': dprob_max = 16 
 if $slave_psy_status = 'soft' or $slave_psy_status = 'optimistic': dprob_max = 9 
 if $slave_psy_status = 'broken': dprob_max = 5
 death_prob = RAND (1,dprob_max)
 IF death_prob = 5:
  slave_died = 1
 END
END

!End of energy check - This END statement is needed - do not remove - crushboss
END

!Love begins with true devotion - crushboss
if slave_state = CONST_INT['slave_exist'] and slave["moral"] >= 5 and master_str >= 5 and master_domination >= 5 and master_cha >= 5: slave['pos_slave_love'] = 100
if assistant_state = 1 and assistant["moral"] >= 5 and master_str >= 5 and master_domination >= 5 and master_cha >= 5: assistant['pos_slave_love'] = 100

!master part
estate_quality = estate_prestige[$estate] + interior_prestige[$study] + interior_prestige[$bath] + interior_prestige[$bed] - house_mess
estate_quality_modifier = estate_quality - brand_reputation 
if brand_reputation > master_cha: master_cha_rate += 1
if master_visage > 0: master_visage -= 1
if master_haircut > 0: master_haircut -= 1

!mood change
a = brand_rate - 11 - master_mood
IF master_mood['pos_show'] < a: 
 master_mood['neg_boring'] += 1
 gs '$mod_master_drop', 1
END

!treat wounds and illness effects
healing = master_medic + assistant["nurse"]
IF master_wounds_rate > 0:
 master_wounds_rate -= master_str + master_mood + healing - master_hygiene + 1
END
IF master_wounds_rate < 0: master_wounds_rate = 0

master_energy += master_str + 1 - master_wounds
if master_energy > 5: master_energy = 5
if master_energy < -5: master_energy = -5

IF master_ill > 0:
 master_ill += 1
 if master_ill > master_str: master_str_rate -= 1
 if master_ill > 6: master_mood['neg_master_ill'] = master_ill
END

!rise health
if master_str < 2: master_str_rate += 1
if master_str < 3: master_str_rate += 1
if master_hygiene < 2: master_str_rate += 1
if house_mess < 2: master_str_rate += 1
if master_str < cooked_food: master_str_rate += cooked_food - master_str
if master_mood > master_str: master_str_rate += 1
if assistant["nurse"] > master_str: master_str_rate += 1
IF snake_amulet_on = 1:
 master_str_rate += 1
 master_domination_rate += 1
END

!Addiction
if master_str < master_alco_addiction: master_str_rate -= 2

IF master_drunk > 0:
 master_mood['neg_drunk'] = 1 + master_alco_addiction
 master_drunk = 0
END
IF master_koffed > 0:
 master_mood['neg_no_koffe'] = master_koffe_addiction - 30
 master_koffed = 0
 master_koffe_addiction += 1
 else
 a = RAND (1,3)
 if a = 1 and master_koffe_addiction > 0: master_koffe_addiction -= 1
END
if master_koffe_addiction > 40: master_str_rate -= 1
IF kannabis_pressure > 0:
 if kannabis_pressure > 30: master_cha_rate -= 1
 a = RAND (1,4)
 if a = 1: kannabis_pressure -= 1 
END
if master_mood['neg_no_meth'] > 1: master_str_rate -= 1
IF master_on_meth > 0:
 a = RAND (2,6)
 master_mood['neg_no_meth'] = master_meth_addiction - a
 if master_mood['neg_no_meth'] > 1: master_energy -= 1
 master_meth_addiction += 1
 master_on_meth = 0
 ELSE
 a = RAND (1,5)
 IF a = 1: master_meth_addiction -= 1
END
if master_mood['neg_no_opium'] > 1: master_str_rate -= 1
IF master_on_opium > 0:
 a = RAND (2,6)
 master_mood['neg_no_opium'] = master_opium_addiction - a
 if master_mood['neg_no_opium'] > 1: gs '$mod_master_drop',100
 master_opium_addiction += 1
 master_on_opium = 0
 ELSE
 a = RAND (1,8)
 IF a = 1: master_opium_addiction -= 1
END
master_energised = 0 

if master_mood['neg_wounded'] < master_wounds: master_mood['neg_wounded'] = master_wounds

!rise arousal
if master_excitement < -5: master_excitement = -5 & master_excitement_rate = -200
if master_excitement < 5: master_excitement_rate += master_libido*10
if master_excitement > 5: master_excitement = 5 & master_excitement_rate = 200
if master_excitement_rate < -200: master_excitement_rate = -200
if master_excitement_rate > 200: master_excitement_rate = 200
if master_libido > 5: master_libido = 5
if master_libido < 0: master_libido = 0
if master_libido_rate <= 1: master_libido_rate = 2

!Beginning of prisoner check - no calculations if no prisoner exists - crushboss
IF prisoner_state > 0:
!prisoner part
if prisoner['neg_prisoner'] < 0: prisoner['neg_prisoner'] = 0
prisoner['neg_prisoner'] += 1  

prisoner['milk_gain'] = 0
prisoner['cream_gain'] = 0
IF prisoner['lactation'] > 0:
 prisoner['milk_gain'] = prisoner["boobs"] + prisoner["stamina"] - 3 + prisoner['mood'] - prisoner['angst']
 if prisoner['age'] = CONST_INT['milf_age']: prisoner['milk_gain'] += 2
 if prisoner['fat'] = 0: prisoner['milk_gain'] = prisoner['milk_gain']/2
 if prisoner['fat'] > 1: prisoner['milk_gain'] += 1
 if prisoner['fat'] > 2: prisoner['milk_gain'] += 2
 if prisoner['fat'] > 3: prisoner['milk_gain'] += 4
 if prisoner['fat'] > 4: prisoner['milk_gain'] += 8  
 prisoner['cream_gain'] = prisoner['milk_gain']/3
 prisoner_rate['custom'] += 1 
END

if prisoner["makeup"] = 1: prisoner["makeup"] = 0
if prisoner["parfume"] = 1: prisoner["parfume"] = 0
if prisoner["epilation"] > 0: prisoner["epilation"] -= 1
if prisoner["manicure"] > 0: prisoner["manicure"] -= 1
if prisoner["hairstyle"] > 0: prisoner["hairstyle"] -= 1

prisoner_rate["hygiene"] += 7
prisoner_rate["hygiene"] += prisoner["wounds"]

!counting calories
prisoner["calories"] = 0

IF prisoner_ration = -1:
 prisoner['starvation'] += 2
 prisoner_rate["fat"] -= 3
 prisoner_rate["fear"] += 5
 prisoner_rate["angst"] += 5    
 prisoner_rate["mood"] -= 5
 prisoner_rate["stamina"] -= 1
 prisoner_food_cost = 0
END

IF prisoner_ration = 1:
 prisoner['starvation'] += 1
 prisoner_rate["fat"] -= 1
 prisoner_rate["fear"] += 2  
 prisoner_rate["angst"] += 2  
 prisoner_rate["mood"] -= 2
 prisoner_food_cost = 1
END

IF prisoner_ration = 0:
 prisoner['starvation'] -= 1
 prisoner_food_cost = 3
END

IF prisoner_ration = 2: 
 prisoner['starvation'] -= 1
 prisoner["neg_slave_food"] = 1 
 prisoner["neg_disgust"] = 1 + prisoner["pride"] - prisoner["preversion"]
 if prisoner["preversion"] = 2: prisoner["pos_cookie"] = 1 & prisoner["neg_slave_food"] = 0
 prisoner["preversion_xp"] += 1 
 IF spawn_semen > 5:
  spawn_semen -= 5
  else
  prisoner_food_cost += spawn_semen
  spawn_semen = 0
 END
END

prisoner_rate["rational"] += prisoner['starvation']
prisoner['neg_hungry'] = prisoner['starvation']
if prisoner['starvation'] < 0: prisoner['starvation'] = 0
if prisoner['starvation'] > prisoner['stamina']: prisoner_rate["stamina"] -= prisoner['starvation']
if prisoner['starvation'] > prisoner['stamina'] and prisoner_state > 0: pstarvation_warning = 1

if prisoner_state ! 0: total_food_cost += prisoner_food_cost

!heal
IF prisoner['koffe_addiction'] > 0:
 prisoner['koffe_addiction'] -= 1
 prisoner_mood['neg_slave_koffe'] = 1 
END
IF prisoner['meth_addiction'] > 0:
 prisoner['meth_addiction'] -= 1
 prisoner_mood['neg_slave_meth'] = 1
END
IF prisoner['opium_addiction'] > 0:
 prisoner['opium_addiction'] -= 1
 prisoner_mood['neg_slave_opium'] = 1
END

prisoner_rate["bruises"] -= prisoner["stamina"]

IF prisoner_rate["wounds"] > 0:
 prisoner_rate["wounds"] -= prisoner["stamina"] + prisoner["mood"] - prisoner["hygiene"]
 prisoner_rate["scares"] += prisoner["wounds"]
END

IF prisoner['ill'] > 0:
 prisoner['ill'] += 1
 if prisoner['ill'] > prisoner['stamina']: prisoner_rate['stamina'] -= 1
 if prisoner['ill'] > 6: prisoner_mood['neg_slave_ill'] = prisoner['ill']
END

IF prisoner['parasite'] > 0:
 prisoner['parasite'] += 1
END

!Menstrual cycle and pregnancy - prisoner - improved and fixed - crushboss
IF prisoner["age"] = CONST_INT['loli_age']: prisoner['fertility'] = -2
if prisoner['fertility'] < 0: prisoner['parasite'] = 0
if prisoner['fertility'] < 0: prisoner['pregnant'] = 0
prisoner['cycle_day'] += 1
if prisoner['cycle_day'] > 28: prisoner['cycle_day'] = 1
IF prisoner['pregnant'] = 0: 
 IF prisoner["age"] ! CONST_INT['loli_age'] and prisoner_state = 1:
  if prisoner['ovulation'] > 0: prisoner['ovulation'] -= 1
  if prisoner['ovulation'] < 0: prisoner['ovulation'] = 0
  IF prisoner['cycle_day'] = 1:
   prisoner['neg_menstruation'] = 6 - prisoner['stamina']
  END
  if prisoner['cycle_day'] = 9: prisoner['ovulation'] = 7
 END
 ELSE
 prisoner['pregnant'] += 1 
 prisoner_rate['stamina'] -= 1
 if prisoner['pregnant'] > 0: prisoner['ovulation'] = 0
END

!Egglaying - prisoner
prisoner['egg_time'] = 0
IF prisoner['pregnant'] > 3 and prisoner['fertility'] = 1:
 IF prisoner['eggs_to_lay'] = 0:
  a = RAND (3,6)
  prisoner['eggs_to_lay'] = prisoner["age"] + prisoner["stamina"] + a + prisoner['fat']
 END
 if prisoner['eggs_to_lay'] = 1: prisoner['pregnant'] = 0
 prisoner['eggs_to_lay'] -= 1
 prisoner['egg_time'] = 1
 prisoner_rate['custom'] += 1 
 if prisoner_virginity < 2: prisoner_virginity = 2 
END

!Reduce the mood if it is high
if prisoner["mood"] > 0:
 prisoner["mood"] -= 1
END

!Obtain/reduce Angst
IF prisoner["mood"] < 0:
 angst_rise = (5 - prisoner["sensitivity"]) + prisoner["mood"]
 if angst_rise < 0: prisoner_rate["angst"] -= angst_rise
 else
 prisoner_rate["angst"] -= prisoner["mood"] * prisoner["angst"]
END

!lowering spoil
prisoner_rate["spoil"] -= 1 + prisoner["fear"]

!Forgotten sins and merits
IF prisoner["virtue"] > 0:
 prisoner_rate["mood"] -= prisoner["virtue"]
 prisoner["virtue"] = 0
END

IF prisoner["sin"] > 0: prisoner["sin"] = 0

!counting arousal and mood
prisoner_rate["mood"] += prisoner["moral"] + (prisoner["stamina"] - 3) + prisoner["energy"] - prisoner["arousal"] - prisoner["fear"] - prisoner["spoil"] - prisoner["angst"] - prisoner["hygiene"] - 5 - prisoner["mood"]

arousal_modifier = 0
if prisoner["nymphomania"] > 0: arousal_modifier += ((prisoner["temper"] + prisoner["sensitivity"] + prisoner["mood"])/2)
if prisoner["nymphomania"] < 0: arousal_modifier -= ((prisoner["temper"] + prisoner["sensitivity"] + prisoner["mood"])/2)
prisoner_rate["arousal"] += (prisoner["stamina"] - 3) + prisoner["temper"] + prisoner["sensitivity"] + prisoner["mood"] - prisoner["angst"] + arousal_modifier

!Angst does the dirty work
if $prisoner_psy_status = 'depresive': prisoner_rate["angst"] += 2

prisoner_rate["temper"] -= prisoner["angst"]
prisoner_rate["ego"] -= prisoner["angst"]

!rest
if prisoner["deprivation_attitude"] = -1: 
 prisoner_rate["fear"] += 20
 prisoner_rate["angst"] += 20   
 prisoner_rate["mood"] -= 20
 prisoner_rate["rational"] += 5
 if prisoner["fear"] < prisoner["sensitivity"]: prisoner["fear"] = prisoner["sensitivity"]
end 
if prisoner["deprivation_attitude"] = 0: 
 prisoner_rate["fear"] += 5
 prisoner_rate["angst"] += 10  
 prisoner_rate["mood"] -= 10
 prisoner_rate["rational"] += 5
 a = prisoner["sensitivity"] - 1
 if prisoner["fear"] < a: prisoner["fear"] = a
end
if prisoner["deprivation_attitude"] = 1: 
 prisoner_rate["fear"] += 3
 prisoner_rate["angst"] += 5
 prisoner_rate["mood"] -= 5
 prisoner_rate["rational"] += 3
 a = prisoner["sensitivity"] - prisoner["ego"]
 if prisoner["fear"] < a: prisoner["fear"] = a
end
if prisoner["deprivation_attitude"] = 2: 
 prisoner_rate["fear"] += 0
 prisoner_rate["mood"] += 2  
end
prisoner["energy"] -= 2  
prisoner_rate["stamina"] -= 1
prisoner["deprivation_xp"] += 1 

prisoner["energy"] += prisoner["stamina"] - 1 - prisoner["wounds"]
if prisoner["energy"] > 5: prisoner["energy"] = 5
if prisoner["energy"] < -5: prisoner["energy"] = -5
!End of prisoner checks - do not remove this END statement - crushboss
END

!Beginning of assistant checks - no calculations if no assistant exists - crushboss
IF assistant_state = 1:
!assistant part
assistant["energy"] += assistant["stamina"] + 1 - assistant["wounds"]
if assistant["energy"] > 5: assistant["energy"] = 5
if assistant["energy"] < -5: assistant["energy"] = -5
assistant["hygiene"] = 0
assistant_rate["hygiene"] = 0

assistant_food_cost = 2
if assistant_state ! 0: total_food_cost += assistant_food_cost

!Assistant lactation - fixed - crushboss
assistant['milk_gain'] = 0
assistant['cream_gain'] = 0
IF assistant['lactation'] > 0:
 assistant['milk_gain'] = assistant["boobs"] + assistant["stamina"] + assistant['mood'] - 3
 if assistant['age'] = CONST_INT['milf_age']: assistant['milk_gain'] += 2
 if assistant['fat'] = 0: assistant['milk_gain'] = assistant['milk_gain']/2
 if assistant['fat'] > 1: assistant['milk_gain'] += 1
 if assistant['fat'] > 2: assistant['milk_gain'] += 2
 if assistant['fat'] > 3: assistant['milk_gain'] += 4
 if assistant['fat'] > 4: assistant['milk_gain'] += 8  
 assistant['cream_gain'] = assistant['milk_gain']/3
 assistant_rate['custom'] += 1
 assistant['lactation'] = 1
 if assistant['milk_gain'] > 2: assistant['lactation'] = 2
 if assistant['milk_gain'] > 5: assistant['lactation'] = 3
 if assistant['milk_gain'] > 8: assistant['lactation'] = 4
 if assistant['milk_gain'] > 11: assistant['lactation'] = 5  
END

!lowering fear
IF assistant_rate["fear"] > 0:
 assistant_rate["fear"] -= 2
END 

!healing, addiction, wounds, illness
IF assistant['koffe_addiction'] > 20:
 if lab_store["koffe"] > 0: lab_store["koffe"] -= 1
END
IF assistant['meth_addiction'] > 4:
 if lab_store["meth"] > 0: lab_store["meth"] -= 1
END
IF assistant['opium_addiction'] > 4:
 if lab_store["opium"] > 0: lab_store["opium"] -= 1
END

assistant_healing = master_medic + assistant["nurse"]
if assistant_healing > 0: assistant_rate["bruises"] -= assistant["stamina"] + assistant_healing

IF assistant_rate["wounds"] > 0:
 assistant_rate["wounds"] -= assistant["stamina"] + assistant_healing
 assistant_rate["scares"] += assistant["wounds"]
END
IF assistant_rate["wounds"] < 0: assistant_rate["wounds"] = 0

IF assistant['ill'] > 0:
 assistant['ill'] += 1
 if assistant['ill'] > assistant['stamina']: assistant_rate['stamina'] -= 1
 if assistant['ill'] > 6: assistant_mood['neg_slave_ill'] = assistant['ill'] 
END

IF assistant['parasite'] > 0:
 assistant['parasite'] += 1
END

!Menstrual cycle and pregnancy - assistant - improved and fixed - crushboss
IF assistant["age"] = CONST_INT['loli_age']: assistant['fertility'] = -2
if assistant['fertility'] < 0: assistant['parasite'] = 0
if assistant['fertility'] < 0: assistant['pregnant'] = 0
assistant['cycle_day'] += 1
if assistant['cycle_day'] > 28: assistant['cycle_day'] = 1
IF assistant['pregnant'] = 0: 
 IF assistant["age"] ! CONST_INT['loli_age'] and assistant_state = 1:
  if assistant['ovulation'] > 0: assistant['ovulation'] -= 1
  if assistant['ovulation'] < 0: assistant['ovulation'] = 0
  IF assistant['cycle_day'] = 1:
   assistant['neg_menstruation'] = 6 - assistant['stamina']
   assistant_menstruation = 1
  END
  if assistant['cycle_day'] = 9: assistant['ovulation'] = 7
 END
 ELSE
 assistant['pregnant'] += 1 
 assistant_rate['stamina'] -= 1
 if assistant['pregnant'] > 0: assistant['ovulation'] = 0
END

!Egglaying - assistant - fixed - crushboss
assistant['egg_time'] = 0
IF assistant['pregnant'] > 3 and assistant['fertility'] = 1:
 IF assistant['eggs_to_lay'] = 0:
  assistant_virginity = 3
  a = RAND (3,6)
  assistant['eggs_to_lay'] = assistant["age"] + assistant["stamina"] + a + assistant['fat']
 END
 if assistant['eggs_to_lay'] = 1: assistant['pregnant'] = 0
 assistant['eggs_to_lay'] -= 1
 assistant['egg_time'] = 1
 assistant_rate['custom'] += 1  
 if assistant_virginity < 2: assistant_virginity = 2  
END

!Obtain/reduce Angst - assistant - crushboss
IF assistant["mood"] < 0:
 angst_rise = 6 - assistant["sensitivity"] + assistant["mood"]
 if angst_rise < 0: assistant_rate["angst"] += assistant["sensitivity"]
 else
 assistant_rate["angst"] -= ((assistant["moral"]*4) + (assistant["instinct"]*3) + (assistant["rational"]*2) + (assistant["custom"]*2))
END

!Angst does the dirty work - assistant
if $assistant_psy_status = 'depresive': assistant_rate["angst"] += 3

IF assistant["angst"] > 0:
 assistant_rate["temper"] -= assistant["angst"]
 assistant_rate["ego"] -= assistant["angst"]
END

a = assistant["stamina"] - assistant["wounds"]
if a < 1 and master_medic > assistant["wounds"]: a = 1
assistant["energy"] += a
if assistant["energy"] > 5: assistant["energy"] = 5
if assistant["energy"] < -5: assistant["energy"] = -5

IF assistant["energy"] = -5 and assistant["stamina"] > 0:
 assistant["energy"] = -4
END

IF assistant["angst"] > 0: 
 gs '$mod_assistant_drop', assistant["angst"]
 if assistant["angst"] > assistant["temper"]: assistant["neg_angst"] = assistant["angst"]
END

!Lowering fear - assistant - crushboss
IF assistant["moral"] > assistant["fear"] and assistant["fear"] > 0 and assistant["mood"] > 0:
 assistant["fear"] -= 1
 assistant_rate["fear"] = 0
 elseif assistant["moral"] > 0 and assistant["fear"] > 0 and assistant["mood"] > 0:
 assistant_rate["fear"] -= (assistant["moral"]*10)
END

!Reduce the mood because of fear - assistant
IF assistant["fear"] > assistant["custom"] and assistant["fear"] > assistant["ego"] and assistant["fear"] > assistant["pride"]:
 if assistant["fear"] > assistant["instinct"]: assistant["neg_fear"] = 1
END

!lowering spoil - assistant - improved - crushboss
if assistant_rate["spoil"] > 0 or assistant["spoil"] > 0: assistant_rate["spoil"] -= (1 + assistant["fear"] + assistant["moral"] + assistant["angst"])
if (assistant_rate["spoil"] > 0 or assistant["spoil"] > 0) and assistant["mood"] < 0: assistant_rate["spoil"] -= assistant["sensitivity"]
if assistant["spoil"] < 0: assistant["spoil"] = 0
if assistant["spoil"] = 0 and assistant_rate["spoil"] < -10: assistant_rate["spoil"] = -10

!counting arousal and mood - assistant
assistant_rate["mood"] += assistant["moral"] + (assistant["stamina"] - 3) + assistant["energy"] + daily_bonus["mood"] - assistant["arousal"] - assistant["fear"] - assistant["spoil"] - assistant["angst"] - assistant["hygiene"] - (house_mess - 1) - assistant["mood"]

if assistant['moral'] > 0: assistant['pos_moral'] = assistant['moral']
if assistant['angst'] > 0: assistant['neg_angst'] = assistant['angst']
if assistant["spoil"] > 0 and assistant["spoil"] > assistant["mood"]: assistant["neg_spoil"] = 1

!Added arousal calculation and modifiers - assistant - crushboss
arousal_modifier = 0
if assistant["nymphomania"] > 0: arousal_modifier += ((assistant["temper"] + assistant["sensitivity"] + assistant["mood"])/2)
if assistant["nymphomania"] < 0: arousal_modifier -= ((assistant["temper"] + assistant["sensitivity"] + assistant["mood"])/2)
assistant_rate["arousal"] += assistant["stamina"] + daily_bonus_assistant["arousal"] + assistant["temper"] + assistant["mood"] + assistant["moral"] + arousal_modifier - (6 + assistant["angst"] + assistant["pride"] + assistant["fear"] + assistant["spoil"]) 
if assistant["arousal"] > 5: assistant["arousal"] = 5
if assistant_rate["arousal"] > 200: assistant_rate["arousal"] = 200

a = ((assistant['pos_orgasm'] + assistant['ego'] + assistant['pride'] + assistant['temper'] + assistant['sensitivity'])/3)
if assistant["arousal"] > 0 and a < assistant["arousal"]: assistant['neg_horny'] = 1
if assistant["nymphomania"] > 1 and assistant["arousal"] > 0: assistant['neg_horny'] = 1
if assistant["nymphomania"] < 0: assistant['neg_horny'] = 0
if assistant['pos_orgasm'] > 0: assistant['pos_orgasm'] -= 1
if assistant['pos_orgasm'] < 0: assistant['pos_orgasm'] = 0

!Growing moral - i.e. Daily Devotion Bonus - assistant - crushboss
moral_app = min (assistant["moral"], assistant["custom"], assistant["rational"], assistant["instinct"])
IF assistant["angst"] < 1 and assistant["mood"] > 0 and moral_app = assistant["moral"] and assistant["spoil"] < 3 and assistant["fear"] < 5 and assistant["pride"] < 5:
 moral_basis = ((assistant["custom"] + assistant["rational"] + assistant["instinct"])/3)
 moral_boost = min (assistant["mood"], moral_basis)
 if moral_boost < 1: moral_boost = 1
 assistant_rate["moral"] += moral_boost
END

!Training bonuses for easy obedience difficulty - crushboss
IF difficulty_setting = 1:
	moral_basis = ((master_str + master_domination + master_fighter + master_cha)/5)
	if moral_basis < 1: moral_basis = 1
	assistant_rate["moral"] += moral_basis
	assistant_rate["custom"] += 1
	assistant_rate["rational"] += 1
	assistant_rate["instinct"] += 1
	assistant_rate["spoil"] -= 5
END

!brand effect - assistant
if assistant['brand'] > 0: assistant_rate["custom"] += 1
if assistant['brand'] = 3: assistant_rate["custom"] += 1

!chance of dying at zero value health - assistant
!base - 14% - min 6% max 20%
IF assistant_state = 1 and assistant["stamina"] = 0:
 dprob_max = 7
! psy status affect the chance
 if $assistant_psy_status = 'servile' or $assistant_psy_status = 'obedient': dprob_max = 16 
 if $assistant_psy_status = 'soft' or $assistant_psy_status = 'optimistic': dprob_max = 9 
 if $assistant_psy_status = 'broken': dprob_max = 5
 death_prob = RAND (1,dprob_max)
 IF death_prob = 5:
  assistant_died = 1
 END
END

!Normalize mood, arousal, and hygiene for assistant - crushboss
IF assistant_state = 1:
 if assistant["mood"] < 2: assistant["mood"] = 2
 assistant_rate["mood"] += 5 + assistant["mood"]
 IF assistant_rate["mood"] >= 50:
  assistant["mood"] += 1
  assistant_rate["mood"] = 0
 END
 IF assistant_rate["mood"] <= -10:
  assistant["mood"] -= 1
  assistant_rate["mood"] = 0
 END
 if assistant["mood"] > 5: assistant["mood"] = 5
 if assistant["mood"] < 0: assistant["mood"] = 0 & assistant_rate["mood"] = 0
END

IF assistant_state = 1 and assistant_washes_rule ! 1 and assistant_washe_slave_rule ! 1 and assistant["energy"] >= 0 and assistant["hygiene"] > 0 and bath > 0:
 assistant_rate["hygiene"] = 0
 assistant["hygiene"] = 0
END

!reset all that does not affect the assistant
assistant["virtue"] = 0
assistant["sin"] = 0
assistant["calories"] = 4

!Dirt and Hygiene from sleep, time, and normal house use - assistant - crushboss
assistant_rate["hygiene"] += 5
assistant_rate["hygiene"] += assistant["wounds"]

!End of assistant checks - do not remove this END statement - crushboss
END

!Dirt and Hygiene from sleep, time, and normal house use - master and slave - crushboss
house_mess_rate += 5
master_hygiene_rate += 5
master_hygiene_rate += master_wounds
slave_rate["hygiene"] += 5
slave_rate["hygiene"] += slave["wounds"]

!food reset
master_food_cost = IIF(cooked_food < 1, 2, 0)

total_food_cost += master_food_cost
if slave_inventory['pony'] > 0: total_food_cost += 1
if assistant_inventory['pony'] > 0: total_food_cost += 1
if prisoner_inventory['pony'] > 0: total_food_cost += 1
cooked_food = -1

!Define the action at the end of the day
!added check for slave status 
!does she want to masturbate
!Added check for energy level of slave and increased the minimum arousal level to 3 - crushboss
slave_will_masturbate = 0
slave_masturbating_anyway = 0
IF slave["arousal"] > slave["pride"] and slave["arousal"] > 2 and slave_state = CONST_INT['slave_exist'] and previous_energy >= 0:
 slave_will_masturbate = 1
 else
 slave_will_masturbate = 0
END
!is there a rule against it
IF rule_masturbation = 1 AND slave_will_masturbate = 1 and previous_energy >= 0: 
 slave_masturbating_anyway = 1
 slave_will_masturbate = 0
END
!is she wearing a chastity belt
IF force_rules = 1 and inventory['chastity_belt'] = 1: slave_masturbating_anyway = 0
!if theres a rule against it, will her taming stop her
IF rule_masturbation = 1 and slave_masturbating_anyway = 1 AND slave["instinct"] > slave["arousal"]:
 slave_rate["instinct"] += 1
 slave_masturbating_anyway = 0
END
!if theres a rule against it, will her obedience stop her
IF rule_masturbation = 1 and slave_masturbating_anyway = 1 AND slave["obedience"] > slave["arousal"] * 3 AND slave["arousal"] < 5:
 slave_rate["instinct"] += 1
 slave_masturbating_anyway = 0
END
!what about devotion?
IF rule_masturbation = 1 and slave_masturbating_anyway = 1 AND slave["moral"] >= slave["arousal"]:
 slave_rate["instinct"] += 1
 slave_masturbating_anyway = 0
END
!if theres a rule against it, will her previously being caught stop her
IF slave_masturbating_anyway = 1 AND slave["caught_masturbating"] > 0:
 slave_masturbating_anyway = 0
END

!Pregnancy Revealed - overhauled entire pregnancy system - added $pregnancy and $pregnancy_assistant modules - crushboss
!Overhauled code to work with Oviparity (egglaying) and sjm_UI_UIadds module - modified pregnancy activities to point to the above modules - crushboss
IF slave['pregnant'] >= 40 and slave["pregnant_revealed"] = 0 and slave['vaginal_modification'] ! 4 and slave['fertility'] = 0: slave["pregnant_revealed"] = 1
IF assistant['pregnant'] >= 40 and assistant["pregnant_revealed"] = 0 and assistant['vaginal_modification'] ! 4 and assistant['fertility'] = 0: assistant["pregnant_revealed"] = 1
IF prisoner['pregnant'] >= 40 and prisoner["pregnant_revealed"] = 0 and prisoner['vaginal_modification'] ! 4 and prisoner['fertility'] = 0: prisoner["pregnant_revealed"] = 1

!Handle slave, assistant, and prisoner - pregnant_revealed - early detection chance - crushboss
IF (slave['pregnant'] > 0 and slave["pregnant_revealed"] = 0 and inventory['stethoscope'] ! 0) and (master_medic > 4 or assistant['nurse'] > 4):
 IF slave['vaginal_modification'] ! 4 and slave['fertility'] ! 1:
 a = RAND(1,21)
 if a = 8: slave["pregnant_revealed"] = 1
 a = 0
 END
END
IF (assistant['pregnant'] > 0 and assistant["pregnant_revealed"] = 0 and inventory['stethoscope'] ! 0) and (master_medic > 4 or assistant['nurse'] > 4):
 IF assistant['vaginal_modification'] ! 4 and assistant['fertility'] ! 1:
 a = RAND(1,21)
 if a = 8: assistant["pregnant_revealed"] = 1
 a = 0
 END
END
IF (prisoner['pregnant'] > 0 and prisoner["pregnant_revealed"] = 0 and inventory['stethoscope'] ! 0) and (master_medic > 4 or assistant['nurse'] > 4):
 IF prisoner['vaginal_modification'] ! 4 and prisoner['fertility'] ! 1:
 a = RAND(1,21)
 if a = 8: prisoner["pregnant_revealed"] = 1
 a = 0
 END
END

!Morning milking
total_milk_gain = 0
total_cream_gain = 0
if slave['milk_gain'] < 0: slave['milk_gain'] = 0
if assistant['milk_gain'] < 0: assistant['milk_gain'] = 0
if prisoner['milk_gain'] < 0: prisoner['milk_gain'] = 0
if slave['cream_gain'] < 0: slave['cream_gain'] = 0
if assistant['cream_gain'] < 0: assistant['cream_gain'] = 0
if prisoner['cream_gain'] < 0: prisoner['cream_gain'] = 0
total_milk_gain = slave['milk_gain'] + assistant['milk_gain'] + prisoner['milk_gain']
total_cream_gain = slave['cream_gain'] + assistant['cream_gain'] + prisoner['cream_gain']
milk_summ += total_milk_gain
cream_summ += total_cream_gain
IF total_milk_gain > 0:
 milking_time = 1
END

:milk_loop
IF milk_summ >= 5:
 milk_bottle_plus += 1
 milk_summ -= 5
 jump 'milk_loop'
END

:cream_loop
IF cream_summ >= 5:
 cream_bottle_plus += 1
 cream_summ -= 5
 jump 'cream_loop'
END

!egg-laying
total_eggs_gain = 0
if slave['egg_time'] < 0: slave['egg_time'] = 0
if assistant['egg_time'] < 0: assistant['egg_time'] = 0
if prisoner['egg_time'] < 0: prisoner['egg_time'] = 0
total_eggs_gain = slave['egg_time'] + assistant['egg_time'] + prisoner['egg_time']
IF total_eggs_gain > 0:
 egg_time = 1
END

!pet tentacle
IF pet_tentacle > 0:
 tentacle_hp -= 1
 if tentacle_size >= 4: tentacle_hp -= 2
 IF tentacle_hp >= tentacle_grow[tentacle_size]:
  if tentacle_size < 4: tentacle_grow_event = 1  
 END
 IF tentacle_hp <= tentacle_death[tentacle_size]:
  tentacle_death_event = 1
 END 
END

!Arousal check for end_day_screen event - crushboss
IF slave["arousal"] > 4 and slave_state = CONST_INT['slave_exist'] and slave["obedience"] > 7 and master_supermacy > 0:
	slave_beg_for_sex = 1
  else
	slave_beg_for_sex = 0
END
IF assistant["arousal"] > 4 and assistant_state = 1 and assistant["obedience"] > 7 and master_supermacy > 0:
	assistant_beg_for_sex = 1
  else
	assistant_beg_for_sex = 0
END

txt_count = 1000
txt = 1
menu_form = 0

!Magic Spell Reset - moved out of $end_day_variable_reset to work with auto casting rules - crushboss
auspex = 0
sententia_veritas = 0
sententia_veritas_casted = 0
magna_magnifika = 0
tremendio = 0
cruciato = 0
spell_adverto_servili = 0
slave['domini_dictum'] = 0
prisoner['domini_dictum'] = 0
assistant['domini_dictum'] = 0

!Lower rehabilitation time by one
if slave['reabilitation'] > 0: slave['reabilitation'] -= 1
if assistant['reabilitation'] > 0: assistant['reabilitation'] -= 1
if prisoner['reabilitation'] > 0: prisoner['reabilitation'] -= 1
if slave['reabilitation'] < 0: slave['reabilitation'] = 0
if assistant['reabilitation'] < 0: assistant['reabilitation'] = 0
if prisoner['reabilitation'] < 0: prisoner['reabilitation'] = 0

!Reset tasks already performed 
killvar 'already_done_today'

if raven_crown_on = 1: auspex = 1

!loss condition in tutorial if slave is killed
IF exam_in_progress = 1:
 IF slave["stamina"] = 0:
  txt = 1
  lecture = 12
  GT 'demo_intro'
 END
END

!autosave condition
IF autosave_day = 1:
 autosave = 1
END

!alone count
IF slave_state = CONST_INT['no_slave'] and assistant_state = 0:
 alone_count += 1
END

!Barn stuff goes here
!farmhand lesbian xp accumulation
IF barn_cow = 1 AND farmhand["homosexualism"] = 0: farmhand["lesbian_xp"] + 1
IF barn_harpy = 1 AND farmhand["homosexualism"] = 0: farmhand["lesbian_xp"] + 1
IF farmhand["lesbian_xp"] > 10 AND farmhand["homosexualism"] = 0: farmhand["homosexualism"] = 1
!bonus calculation
IF barn_farmhand = 1:
 barn_farmhand_bonus = 120
 IF barn_farmhand["homosexualism"] = -1: barn_farmhand_bonus -= 10
 IF barn_farmhand["homosexualism"] = 1: barn_farmhand_bonus += 20
 IF barn_farmhand["homosexualism"] = 2: barn_farmhand_bonus += 30
 ELSE
 barn_farmhand_bonus = 100
END

!milking the cow
IF barn_cow = 1:
 cow['milk_gain'] = cow["boobs"] + cow["stamina"] - 3
 if cow['age'] = CONST_INT['milf_age']: cow['milk_gain'] += 2
 if cow['fat'] = 0: cow['milk_gain'] = cow['milk_gain']/2
 if cow['fat'] > 1: cow['milk_gain'] += 1
 if cow['fat'] > 2: cow['milk_gain'] += 2
 if cow['fat'] > 3: cow['milk_gain'] += 4
 if cow['fat'] > 4: cow['milk_gain'] += 8  
 cow['cream_gain'] = cow['milk_gain']/3
 !setting lactation rating
 cow['lactation'] = 1
 if cow['milk_gain'] > 2: cow['lactation'] = 2
 if cow['milk_gain'] > 5: cow['lactation'] = 3
 if cow['milk_gain'] > 8: cow['lactation'] = 4
 if cow['milk_gain'] > 11: cow['lactation'] = 5  
 cow['milk_gain'] = cow['milk_gain']*barn_farmhand_bonus
 cow['milk_gain'] = cow['milk_gain']/100
 barn_milk = cow['milk_gain']
 barn_cream = cow['milk_gain']/3
 !check if the cow has recovered from surgery
 IF cow['reabilitation'] > 0:
  cow['reabilitation'] -= 1
  cow['milk_gain'] = 0
  cow['lactation'] = 0
 END 
 !If there is room in the fridge, refill it
 IF frige_space >= 5:
  barn_milk += frige["milk"]
  frige["milk"] = 0
  IF barn_milk < 5:
   frige["milk"] = barn_milk
   barn_milk = 0
   ELSE
   frige["milk"] = 5
   barn_milk -= 5
  END
 END
 IF frige_space >= 5:
  barn_cream += frige["cream"]
  frige["cream"] = 0
  IF barn_cream < 5:
   frige["cream"] = barn_cream
   barn_cream = 0
   ELSE
   frige["cream"] = 5
   barn_cream -= 5
  END
 END
 !Sell any leftover milk and cream - money comes in during end-of-decade billing
 barn_milk_profit += barn_milk/2
 barn_cream_profit += barn_cream
 !gradual breast growth
 IF barn_farmhand = 1:
  IF cow['reabilitation'] = 0:
   cow['days_milked'] += 1
   IF cow['days_milked'] = 20:
    cow['days_milked'] = 0
    cow["boobs"] += 1
    IF cow["boobs"] > 8: cow["boobs"] = 8
    if $cow["boobs_img"] = 'boobs_G': $cow["boobs_img"] = 'boobs_H' 
    if $cow["boobs_img"] = 'boobs_F': $cow["boobs_img"] = 'boobs_G' 
    if $cow["boobs_img"] = 'boobs_EE': $cow["boobs_img"] = 'boobs_F' 
    if $cow["boobs_img"] = 'boobs_E': $cow["boobs_img"] = 'boobs_F' 
    if $cow["boobs_img"] = 'boobs_DD': $cow["boobs_img"] = 'boobs_EE' 
    if $cow["boobs_img"] = 'boobs_D': $cow["boobs_img"] = 'boobs_E' 
    if $cow["boobs_img"] = 'boobs_CC': $cow["boobs_img"] = 'boobs_DD' 
    if $cow["boobs_img"] = 'boobs_C': $cow["boobs_img"] = 'boobs_D' 
    if $cow["boobs_img"] = 'boobs_BB': $cow["boobs_img"] = 'boobs_CC' 
    if $cow["boobs_img"] = 'boobs_B': $cow["boobs_img"] = 'boobs_C' 
    if $cow["boobs_img"] = 'boobs_A': $cow["boobs_img"] = 'boobs_B' 
    if $cow["boobs_img"] = 'boobs_FP': $cow["boobs_img"] = 'boobs_HP' 
    if $cow["boobs_img"] = 'boobs_EP': $cow["boobs_img"] = 'boobs_FP' 
    if $cow["boobs_img"] = 'boobs_DP': $cow["boobs_img"] = 'boobs_EP' 
    if $cow["boobs_img"] = 'boobs_CP': $cow["boobs_img"] = 'boobs_DP' 
    if $cow["boobs_img"] = 'boobs_BP': $cow["boobs_img"] = 'boobs_CP' 
    if $cow["boobs_img"] = 'boobs_AP': $cow["boobs_img"] = 'boobs_BP' 
   END
  END
 END
END

!eggs
IF barn_harpy = 1:
 !calculate egg amount
 a = RAND (3,6)
 barn_harpy_eggs = harpy["age"] + harpy["stamina"] + a + harpy['fat']
 harpy['egglaying'] = 1
 !set egglaying rating
 if barn_harpy_eggs > 5: harpy['egglaying'] = 2
 if barn_harpy_eggs > 7: harpy['egglaying'] = 3
 if barn_harpy_eggs > 9: harpy['egglaying'] = 4
 if barn_harpy_eggs > 12: harpy['egglaying'] = 5
 barn_harpy_eggs = barn_harpy_eggs*barn_farmhand_bonus
 barn_harpy_eggs = barn_harpy_eggs/100
 !check to see if harpy''s recovered from surgery
 IF harpy['reabilitation'] > 0:
  harpy['reabilitation'] -= 1
  barn_harpy_eggs = 0
  harpy['egglaying'] = 0
 END 
 !refill the fridge 
 IF frige_space >= 5:
  barn_harpy_eggs += frige["eggs"]
  frige["eggs"] = 0
  IF barn_harpy_eggs < 5:
   frige["eggs"] = barn_harpy_eggs
   barn_harpy_eggs = 0
   ELSE
   frige["eggs"] = 5
   barn_harpy_eggs -= 5
  END
 END
 !sell any leftover eggs
 barn_egg_profit += barn_harpy_eggs/2
END

!cow food calc and weight gain
IF barn_cow = 1:
 barn_cow_food += 2 + cow['lactation'] + cow['age']
 IF barn_farmhand_fattens = 1 AND barn_farmhand = 1:
  barn_cow_food += 5
  cow_rate['fat'] += 5
 END
 IF cow['fat'] = 0:
  if cow_rate['fat'] >= 10: cow['fat'] = 1 & cow_rate['fat'] = 0 
 END
 IF cow['fat'] = 1:
  if cow_rate['fat'] >= 10: cow['fat'] = 2 & cow_rate['fat'] = 0 
 END
 IF cow['fat'] = 2:
  if cow_rate['fat'] >= 20: cow['fat'] = 3 & cow_rate['fat'] = 0 
 END
 IF cow['fat'] = 3:
  if cow_rate['fat'] >= 40: cow['fat'] = 4 & cow_rate['fat'] = 0 
 END
 IF cow['fat'] = 4:
  if cow_rate['fat'] >= 80: cow['fat'] = 5 & cow_rate['fat'] = 0 
 END
 IF cow['fat'] = 5:
  if cow_rate['fat'] > 10: cow_rate['fat'] = 10
 END 
END

!harpy food calc and weight gain
IF barn_harpy = 1:
 barn_harpy_food += 2 + harpy['egglaying'] + harpy['age']
 IF barn_farmhand_fattens = 1 AND barn_farmhand = 1:
  barn_harpy_food += 5
  harpy_rate['fat'] += 5
 END
 IF harpy['fat'] = 0:
  if harpy_rate['fat'] >= 10: harpy['fat'] = 1 & harpy_rate['fat'] = 0 
 END
 IF harpy['fat'] = 1:
  if harpy_rate['fat'] >= 10: harpy['fat'] = 2 & harpy_rate['fat'] = 0 
 END
 IF harpy['fat'] = 2:
  if harpy_rate['fat'] >= 20: harpy['fat'] = 3 & harpy_rate['fat'] = 0 
 END
 IF harpy['fat'] = 3:
  if harpy_rate['fat'] >= 40: harpy['fat'] = 4 & harpy_rate['fat'] = 0 
 END
 IF harpy['fat'] = 4:
  if harpy_rate['fat'] >= 80: harpy['fat'] = 5 & harpy_rate['fat'] = 0 
 END
 IF harpy['fat'] = 5:
  if harpy_rate['fat'] > 10: harpy_rate['fat'] = 10
 END
END

!pig food calc and weight gain
IF barn_pig = 1:
 barn_pig_food += 4
 pig_rate['fat'] += 5
 IF barn_farmhand = 1: barn_pig_food += 1
 IF barn_farmhand = 1: pig_rate['fat'] += 2
 IF pig['fat'] = 0:
  if pig_rate['fat'] >= 10: pig['fat'] = 1 & pig_rate['fat'] = 0 
 END
 IF pig['fat'] = 1:
  if pig_rate['fat'] >= 10: pig['fat'] = 2 & pig_rate['fat'] = 0 
 END
 IF pig['fat'] = 2:
  if pig_rate['fat'] >= 20: pig['fat'] = 3 & pig_rate['fat'] = 0 
 END
 IF pig['fat'] = 3:
  if pig_rate['fat'] >= 40: pig['fat'] = 4 & pig_rate['fat'] = 0 
 END
 IF pig['fat'] = 4:
  if pig_rate['fat'] >= 80: pig['fat'] = 5 & pig_rate['fat'] = 0 
 END
 IF pig['fat'] = 5:
  if pig_rate['fat'] > 10: pig_rate['fat'] = 10
 END
END

!pig fitness levelling - increases or decreases to 3
IF barn_pig = 1: 
 IF barn_farmhand = 0 AND pig['stamina'] > 3: pig_rate['stamina'] -= 4
 IF pig['stamina'] < 3: pig_rate['stamina'] += 4
 IF pig['stamina'] = 0:
  if pig_rate['stamina'] >= 10: pig['stamina'] = 1 & pig_rate['stamina'] = 0 
 END
 IF pig['stamina'] = 1:
  if pig_rate['stamina'] >= 10: pig['stamina'] = 2 & pig_rate['stamina'] = 0 
 END
 IF pig['stamina'] = 2:
  if pig_rate['stamina'] >= 20: pig['stamina'] = 3 & pig_rate['stamina'] = 0 
 END
 IF pig['stamina'] = 4:
  if pig_rate['stamina'] <= -80: pig['stamina'] = 3 & pig_rate['stamina'] = 0
 END
 IF pig['stamina'] = 5:
  if pig_rate['stamina'] <= -80: pig['stamina'] = 4 & pig_rate['stamina'] = 0  
 END
END

!cow fitness levelling
IF barn_cow = 1: 
 IF barn_farmhand = 0 AND cow['stamina'] > 3: cow_rate['stamina'] -= 2
 IF cow['stamina'] < 3: cow_rate['stamina'] += 2
 IF cow['stamina'] = 0:
  if cow_rate['stamina'] >= 10: cow['stamina'] = 1 & cow_rate['stamina'] = 0 
 END
 IF cow['stamina'] = 1:
  if cow_rate['stamina'] >= 10: cow['stamina'] = 2 & cow_rate['stamina'] = 0 
 END
 IF cow['stamina'] = 2:
  if cow_rate['stamina'] >= 20: cow['stamina'] = 3 & cow_rate['stamina'] = 0 
 END
 IF cow['stamina'] = 4:
  if cow_rate['stamina'] <= -80: cow['stamina'] = 3 & cow_rate['stamina'] = 0
 END
 IF cow['stamina'] = 5:
  if cow_rate['stamina'] <= -80: cow['stamina'] = 4 & cow_rate['stamina'] = 0  
 END
END

!egglayer fitness levelling
IF barn_harpy = 1: 
 IF barn_farmhand = 0 AND harpy['stamina'] > 3: harpy_rate['stamina'] -= 2
 IF harpy['stamina'] < 3: harpy_rate['stamina'] += 2
 IF harpy['stamina'] = 0:
  if harpy_rate['stamina'] >= 10: harpy['stamina'] = 1 & harpy_rate['stamina'] = 0 
 END
 IF harpy['stamina'] = 1:
  if harpy_rate['stamina'] >= 10: harpy['stamina'] = 2 & harpy_rate['stamina'] = 0 
 END
 IF harpy['stamina'] = 2:
  if harpy_rate['stamina'] >= 20: harpy['stamina'] = 3 & harpy_rate['stamina'] = 0 
 END
 IF harpy['stamina'] = 4:
  if harpy_rate['stamina'] <= -80: harpy['stamina'] = 3 & harpy_rate['stamina'] = 0
 END
 IF harpy['stamina'] = 5:
  if harpy_rate['stamina'] <= -80: harpy['stamina'] = 4 & harpy_rate['stamina'] = 0  
 END
END

!pig slaughter
IF barn_pig = 1 AND pig['fat'] = 5 AND barn_farmhand = 1 AND barn_farmhand_slaughters = 1:
 !adapted from the regular sell-for-meat code
 base_meat_gain = (pig["boobs"] + 2)
 if pig["fat"] > 0: base_meat_gain = base_meat_gain*2
 mince_gain = 0
 mince_bonus = 0
 if pig["fat"] = 1: mince_gain = pig["boobs"]
 if pig["fat"] = 2: mince_gain = pig["boobs"]*2
 if pig["fat"] = 3: mince_gain = pig["boobs"]*3
 if pig["fat"] = 4: mince_gain = pig["boobs"]*4
 if pig["fat"] = 5: mince_gain = pig["boobs"]*5
 if mince_gain < pig["fat"]: mince_gain = pig["fat"] 
 meat_max = 1 + pig["stamina"]
 IF base_meat_gain > meat_max:
  meat_gain = meat_max
  mince_bonus = base_meat_gain - meat_max
  else
  meat_gain = base_meat_gain
 END
 mince_gain += mince_bonus
 IF pig['age'] = CONST_INT['loli_age']:
  virgin_meat_gain = meat_gain
  meat_gain = 0
 END
 IF pig['age'] = CONST_INT['young_age'] and virginity = 0:
  virgin_meat_gain = meat_gain
  meat_gain = 0
 END
 !kill the pig
 barn_pig = 0
 pig_state = CONST_INT['no_slave']
 killvar 'pig' 
 killvar '$pig'
 killvar 'pig_rate' 
 killvar 'already_done_pig'
 killvar 'pig_inventory'
 prise_promised_pig = 0
 gift_promised_pig = 0
 prise_promised_pig = 0
 abandon_treat_pig = 0
 death_treat_pig = 0
 pig_slave_sleep_condition = 0
 pig_slave_food_type = 0
 pig_slave_eats_remains = 0
 pig_slave_ration = 0
 pig_slave_food_portion = 0
 pig_vitamin = 0
 pig_silence_rule = 0
 pig_master_rule = 0
 pig_orgasm_prohibited = 0
 pig_shit_prohibited = 0
 pig_pet_rule = 0
 pig_blowjob_rule = 0
 pig_pissuar_rule = 0
 pig_toilet_rule = 0
 pig_slave_cleans_rule = 0
 pig_slave_cooks_rule = 0
 pig_slave_washes_rule = 0
 pig_slave_tentacle_rule = 0
 pig_v_balls_rule = 0
 pig_rule_masturbation = 0
 !refill the fridge
 IF frige_space >= 5 AND estate_size[$estate] = 50:
  mince_gain += frige["mince"]
  frige["mince"] = 0
  IF mince_gain < 5:
   frige["mince"] = mince_gain
   mince_gain = 0
   ELSE
   frige["mince"] = 5
   mince_gain -= 5
  END
 END
 IF frige_space >= 5 AND estate_size[$estate] = 50:
  meat_gain += frige["meat"]
  frige["meat"] = 0
  IF meat_gain < 5:
   frige["meat"] = meat_gain
   meat_gain = 0
   ELSE
   frige["meat"] = 5
   meat_gain -= 5
  END
 END
 IF frige_space >= 5 AND estate_size[$estate] = 50:
  virgin_meat_gain += frige["virgin_meat"]
  frige["virgin_meat"] = 0
  IF virgin_meat_gain < 5:
   frige["virgin_meat"] = virgin_meat_gain
   virgin_meat_gain = 0
   ELSE
   frige["virgin_meat"] = 5
   virgin_meat_gain -= 5
  END
 END
 IF frige_space >= 7 AND estate_size[$estate] = 70:
  mince_gain += frige["mince"]
  frige["mince"] = 0
  IF mince_gain < 7:
   frige["mince"] = mince_gain
   mince_gain = 0
   ELSE
   frige["mince"] = 7
   mince_gain -= 7
  END
 END
 IF frige_space >= 7 AND estate_size[$estate] = 70:
  meat_gain += frige["meat"]
  frige["meat"] = 0
  IF meat_gain < 7:
   frige["meat"] = meat_gain
   meat_gain = 0
   ELSE
   frige["meat"] = 7
   meat_gain -= 7
  END
 END
 IF frige_space >= 7 AND estate_size[$estate] = 70:
  virgin_meat_gain += frige["virgin_meat"]
  frige["virgin_meat"] = 0
  IF virgin_meat_gain < 7:
   frige["virgin_meat"] = virgin_meat_gain
   virgin_meat_gain = 0
   ELSE
   frige["virgin_meat"] = 7
   virgin_meat_gain -= 7
  END
 END
 IF frige_space >= 10 AND estate_size[$estate] = 100:
  mince_gain += frige["mince"]
  frige["mince"] = 0
  IF mince_gain < 10:
   frige["mince"] = mince_gain
   mince_gain = 0
   ELSE
   frige["mince"] = 10
   mince_gain -= 10
  END
 END
 IF frige_space >= 10 AND estate_size[$estate] = 100:
  meat_gain += frige["meat"]
  frige["meat"] = 0
  IF meat_gain < 10:
   frige["meat"] = meat_gain
   meat_gain = 0
   ELSE
   frige["meat"] = 10
   meat_gain -= 10
  END
 END
 IF frige_space >= 10 AND estate_size[$estate] = 100:
  virgin_meat_gain += frige["virgin_meat"]
  frige["virgin_meat"] = 0
  IF virgin_meat_gain < 10:
   frige["virgin_meat"] = virgin_meat_gain
   virgin_meat_gain = 0
   ELSE
   frige["virgin_meat"] = 10
   virgin_meat_gain -= 10
  END
 END
 IF frige_space >= 15 AND estate_size[$estate] = 150:
  mince_gain += frige["mince"]
  frige["mince"] = 0
  IF mince_gain < 15:
   frige["mince"] = mince_gain
   mince_gain = 0
   ELSE
   frige["mince"] = 15
   mince_gain -= 15
  END
 END
 IF frige_space >= 15 AND estate_size[$estate] = 150:
  meat_gain += frige["meat"]
  frige["meat"] = 0
  IF meat_gain < 15:
   frige["meat"] = meat_gain
   meat_gain = 0
   ELSE
   frige["meat"] = 15
   meat_gain -= 15
  END
 END
 IF frige_space >= 15 AND estate_size[$estate] = 150:
  virgin_meat_gain += frige["virgin_meat"]
  frige["virgin_meat"] = 0
  IF virgin_meat_gain < 15:
   frige["virgin_meat"] = virgin_meat_gain
   virgin_meat_gain = 0
   ELSE
   frige["virgin_meat"] = 15
   virgin_meat_gain -= 15
  END
 END
 IF frige_space >= 20 AND estate_size[$estate] = 200:
  mince_gain += frige["mince"]
  frige["mince"] = 0
  IF mince_gain < 20:
   frige["mince"] = mince_gain
   mince_gain = 0
   ELSE
   frige["mince"] = 20
   mince_gain -= 20
  END
 END
 IF frige_space >= 20 AND estate_size[$estate] = 200:
  meat_gain += frige["meat"]
  frige["meat"] = 0
  IF meat_gain < 20:
   frige["meat"] = meat_gain
   meat_gain = 0
   ELSE
   frige["meat"] = 20
   meat_gain -= 20
  END
 END
 IF frige_space >= 20 AND estate_size[$estate] = 200:
  virgin_meat_gain += frige["virgin_meat"]
  frige["virgin_meat"] = 0
  IF virgin_meat_gain < 20:
   frige["virgin_meat"] = virgin_meat_gain
   virgin_meat_gain = 0
   ELSE
   frige["virgin_meat"] = 20
   virgin_meat_gain -= 20
  END
 END
 IF frige_space >= 25 AND estate_size[$estate] = 250:
  mince_gain += frige["mince"]
  frige["mince"] = 0
  IF mince_gain < 25:
   frige["mince"] = mince_gain
   mince_gain = 0
   ELSE
   frige["mince"] = 25
   mince_gain -= 25
  END
 END
 IF frige_space >= 25 AND estate_size[$estate] = 250:
  meat_gain += frige["meat"]
  frige["meat"] = 0
  IF meat_gain < 25:
   frige["meat"] = meat_gain
   meat_gain = 0
   ELSE
   frige["meat"] = 25
   meat_gain -= 25
  END
 END
 IF frige_space >= 25 AND estate_size[$estate] = 250:
  virgin_meat_gain += frige["virgin_meat"]
  frige["virgin_meat"] = 0
  IF virgin_meat_gain < 25:
   frige["virgin_meat"] = virgin_meat_gain
   virgin_meat_gain = 0
   ELSE
   frige["virgin_meat"] = 25
   virgin_meat_gain -= 25
  END
 END
 barn_pig_profit += mince_gain + meat_gain*2 + virgin_meat_gain*4
END

!Post Patrician Quest - Daily Quest Handling - crushboss
if active[$quest[12]] = 1: gs 'quest12'

end_of_the_day = 1
if rules_broken = 1: rules_broken_message = 1

!Save current interior settings - crushboss
gs 'interior_storage'

GT 'end_day_screen'

--- next_day ---------------------------------

