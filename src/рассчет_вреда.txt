# рассчет_вреда
!CALCULATION OF DAMAGE FROM ALL MODIFIERS
модификатор = 0

!Interaction of the type of protection and attack
$эффект = 'удвоение'
if $защита[def] = 'блок' and $атака[atk] = 'сильная': модификатор += 1 
if $защита[def] = 'уклонение' and $атака[atk] = 'быстрая': модификатор += 1
if $защита[def] = 'контратака' and $атака[atk] = 'точная': модификатор += 1

if $защита[def] = 'блок' and $атака[atk] = 'точная': $эффект = 'бонус'
if $защита[def] = 'уклонение' and $атака[atk] = 'сильная': $эффект = 'бонус'
if $защита[def] = 'контратака' and $атака[atk] = 'быстрая': $эффект = 'бонус'

if $защита[def] = 'блок' and $атака[atk] = 'быстрая': $эффект = 'штраф'
if $защита[def] = 'уклонение' and $атака[atk] = 'точная': $эффект = 'штраф'
if $защита[def] = 'контратака' and $атака[atk] = 'сильная': $эффект = 'штраф'

!taking statuses into account
IF $атака[atk] = 'сильная':
 if бешенство[atk] > 0: модификатор += 1
 if шаткость[def] > 0: модификатор += 1
 if слабость[atk] > 0: модификатор -= 1
 if адреналин[def] > 0: модификатор -= 1
END

IF $атака[atk] = 'быстрая':
 if разгон[atk] > 0: модификатор += 1
 if ошеломление[def] > 0: модификатор += 1
 if скованность[atk] > 0: модификатор -= 1
 if верткость[def] > 0: модификатор -= 1
END

IF $атака[atk] = 'точная':
 if меткость[atk] > 0: модификатор += 1
 if рассеянность[def] > 0: модификатор += 1
 if боль[atk] > 0: модификатор -= 1
 if внимание[def] > 0: модификатор -= 1
END

!damage calculation itself
if модификатор < -2: нанесенный_вред[atk] = вред_на_рассчет/6
if модификатор = -2: нанесенный_вред[atk] = вред_на_рассчет/4
if модификатор = -1: нанесенный_вред[atk] = вред_на_рассчет/2
if модификатор = 0: нанесенный_вред[atk] = вред_на_рассчет
if модификатор = 1: нанесенный_вред[atk] = вред_на_рассчет*2
if модификатор = 2: нанесенный_вред[atk] = вред_на_рассчет*4
if модификатор > 2: нанесенный_вред[atk] = вред_на_рассчет*6

модифер = 0

IF def = 0: dynamic 'модифер = модификатор_<<$рассчетный_тип_вреда>>'
IF def > 0: dynamic 'модифер = модификатор_<<$рассчетный_тип_вреда>>[$враг[def]]'
нанесенный_вред[atk] += модифер

IF нанесенный_вред[atk] < 1:
 нанесенный_вред[atk] = 1
 a = RAND(1,10)
 if a = 1: нанесенный_вред[atk] += 1
 if a = 2: нанесенный_вред[atk] += 2
 if a = 3: нанесенный_вред[atk] += 3
 a = 0
END

$тип_нанесенного_вреда[atk] = $рассчетный_тип_вреда

--- рассчет_вреда ---------------------------------

